
var tooltipDelay=4000;var tooltipDivID;var tipTimeout=0;var wggChart={makeArea:function(container,data,options){var cfg={title:"",measure:"Preis (in â‚¬)",tickLabelFormat:".2s",timeformat:"%d-%b-%y",outputTimeformat:"%d.%m.",color:["#3182BD"],showgrid:true};if('undefined'!==typeof options){for(var i in options){if('undefined'!==typeof options[i]){cfg[i]=options[i];}}}
var div=d3.select("#"+container);var w=parseInt(div.style("width"));var h=parseInt(div.style("height"));this.removeDiv(container);if(cfg.title.length>0){var margin={top:40,right:20,bottom:30,left:40};}else{var margin={top:20,right:20,bottom:30,left:40};}
var width=w-margin.left-margin.right;var height=h-margin.top-margin.bottom;var parseDate=d3.time.format(cfg.timeformat).parse;var color=d3.scale.ordinal().range(cfg.color);var x=d3.time.scale().range([0,width]);var y=d3.scale.linear().range([height,0]);var xAxis=d3.svg.axis().scale(x).orient("bottom").tickFormat(d3.time.format(cfg.outputTimeformat));var yAxis=d3.svg.axis().scale(y).tickFormat(d3.format(cfg.tickLabelFormat)).orient("left");var x_grid=d3.svg.axis().scale(x).orient("bottom").tickSize(-height).tickFormat("");var y_grid=d3.svg.axis().scale(y).orient("left").tickSize(-width).tickFormat("");var area=d3.svg.area().x(function(d){return x(d.date);}).y0(height).y1(function(d){return y(d.value);});var svg=d3.select("#"+container).append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")");data.forEach(function(d){d.date=parseDate(d.date);d.value=+d.value;});x.domain(d3.extent(data,function(d){return d.date;}));y.domain([0,d3.max(data,function(d){return d.value;})]);if(cfg.showgrid){svg.append("g").attr("class","x grid").attr("transform","translate(0,"+height+")").call(x_grid);svg.append("g").attr("class","y grid").call(y_grid);}
svg.append("path").datum(data).attr("class","area").attr("d",area).style("fill",function(d){return color(d.name);});svg.append("g").attr("class","x axis").attr("transform","translate(0,"+height+")").call(xAxis);svg.append("g").attr("class","y axis").call(yAxis).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text(cfg.measure);if(cfg.title.length>0){svg.append("g").attr("class","charttitle").append("text").attr("x",width/2).attr("y",-14).attr("text-anchor","middle").attr("class","charttitle").text(cfg.title);}},makeBar:function(container,data,options){var cfg={title:"",measure:"Anzahl",tickLabelFormat:".2s",description:"Produkt",showgrid:true,addline:0,colors:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"]};if('undefined'!==typeof options){for(var i in options){if('undefined'!==typeof options[i]){cfg[i]=options[i];}}}
var div=d3.select("#"+container);var w=parseInt(div.style("width"));var h=parseInt(div.style("height"));this.removeDiv(container);var formatNumbers=d3.format(cfg.tickLabelFormat);var tip=d3.tip(container).attr('class','d3-tip').html(function(d){return"<span class='valuecolor'>"+formatNumbers(d.value)+"</span>";});if(cfg.title.length>0){var margin={top:40,right:20,bottom:30,left:40};}else{var margin={top:20,right:20,bottom:30,left:40};}
var width=w-margin.left-margin.right;var height=h-margin.top-margin.bottom;var color=d3.scale.ordinal().range(cfg.colors);var x=d3.scale.ordinal().rangeRoundBands([0,width],.1);var y=d3.scale.linear().range([height,0]);var xAxis=d3.svg.axis().scale(x).orient("bottom");var yAxis=d3.svg.axis().scale(y).orient("left").tickFormat(d3.format(cfg.tickLabelFormat)).ticks(10,"%");var x_grid=d3.svg.axis().scale(x).orient("bottom").tickSize(-height).tickFormat("");var y_grid=d3.svg.axis().scale(y).orient("left").tickSize(-width).tickFormat("");var svg=d3.select("#"+container).append("svg").attr("id","chartspace").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")").call(tip);x.domain(data.map(function(d){return d.label;}));y.domain([0,d3.max(data,function(d){return d.value;})]);svg.append("g").attr("class","x axis").attr("transform","translate(0,"+height+")").call(xAxis).append("text").style("text-anchor","end").attr("dy","1.5em").text(cfg.description);svg.append("g").attr("class","y axis").call(yAxis).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text(cfg.measure);if(cfg.showgrid){svg.append("g").attr("class","x grid").attr("transform","translate(0,"+height+")").call(x_grid);svg.append("g").attr("class","y grid").call(y_grid);}
svg.selectAll(".bar").data(data).enter().append("rect").attr("class","bar").attr("x",function(d){return x(d.label);}).attr("width",x.rangeBand()).attr("y",function(d){return y(d.value);}).style("fill",function(d){return color(d.label);}).attr("height",function(d){return height-y(d.value);}).on('mouseover',tip.show).on('mouseout',tip.hide);if(cfg.title.length>0){svg.append("g").attr("class","charttitle").append("text").attr("x",width/2).attr("y",-14).attr("text-anchor","middle").attr("class","charttitle").text(cfg.title);}
if(cfg.addline!=0){svg.append("g").attr("class","x axis").append("line").attr("x1",width).attr("y1",y(cfg.addline)).attr("y2",y(cfg.addline));}
function type(d){d.value=+d.value;return d;}},makeVerticalBar:function(container,data,options){var cfg={title:"",measure:"Anzahl",tickLabelFormat:".2s",showgrid:true,linebase:0,colors:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"]};if('undefined'!==typeof options){for(var i in options){if('undefined'!==typeof options[i]){cfg[i]=options[i];}}}
var formatNumbers=d3.format(cfg.tickLabelFormat);var tip=d3.tip(container).attr('class','d3-tip').html(function(d){return d.label+"<br><span class='valuecolor'>"+formatNumbers(d.value)+"</span> ";});var div=d3.select("#"+container);var w=parseInt(div.style("width"));var h=parseInt(div.style("height"));this.removeDiv(container);if(cfg.title.length>0){var margin={top:60,right:20,bottom:30,left:40};}else{var margin={top:40,right:20,bottom:30,left:40};}
var width=w-margin.left-margin.right;var height=h-margin.top-margin.bottom;var x=d3.scale.linear().range([0,width])
var y=d3.scale.ordinal().rangeRoundBands([0,height],.2);var xAxis=d3.svg.axis().scale(x).tickFormat(d3.format(cfg.tickLabelFormat)).orient("top");var x_grid=d3.svg.axis().scale(x).orient("bottom").tickSize(-height).tickFormat("");var y_grid=d3.svg.axis().scale(y).orient("left").tickSize(-width).tickFormat("");var svg=d3.select("#"+container).append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")").call(tip);x.domain(d3.extent(data,function(d){return d.value;})).nice();y.domain(data.map(function(d){return d.label;}));svg.append("g").attr("class","x axis").call(xAxis).append("text").attr("x",6).attr("y",6).attr("dy",".71em").style("text-anchor","start").text(cfg.measure);svg.append("g").attr("class","y axis").append("line").attr("x1",x(cfg.linebase)).attr("x2",x(cfg.linebase)).attr("y2",height);if(cfg.showgrid){svg.append("g").attr("class","x grid").attr("transform","translate(0,"+height+")").call(x_grid);svg.append("g").attr("class","y grid").call(y_grid);}
var bar=svg.selectAll(".bar").data(data).enter().append("g").attr("class",function(d){return d.value<0?"bar negative":"bar positive";});bar.append("rect").style("fill",function(d){return d.value<0?cfg.colors[0]:cfg.colors[1];}).attr("x",function(d){return x(Math.min(0,d.value));}).attr("y",function(d){return y(d.label);}).attr("width",function(d){return Math.abs(x(d.value)-x(0));}).attr("height",y.rangeBand()).on('mouseover',tip.show).on('mouseout',tip.hide);bar.append("text").attr("x",function(d){return d.value<0?x(Math.max(0,d.value)):x(Math.min(0,d.value));}).attr("dx",function(d){return d.value<0?".71em":"-.71em";}).attr("dy",parseInt(y.rangeBand()/2)).attr("y",function(d){return y(d.label);}).style("fill","#000000").style("text-anchor",function(d){return d.value<0?"start":"end";}).text(function(d){return d.label;})
if(cfg.title.length>0){svg.append("g").attr("class","charttitle").append("text").attr("x",width/2).attr("y",-34).attr("text-anchor","middle").attr("class","charttitle").text(cfg.title);}
function type(d){d.value=+d.value;return d;}},makeBubble:function(container,json,options){var cfg={tickLabelFormat:".2s",showtips:true};if('undefined'!==typeof options){for(var i in options){if('undefined'!==typeof options[i]){cfg[i]=options[i];}}}
var formatNumbers=d3.format(cfg.tickLabelFormat);var data=json[0];var div=d3.select("#"+container);var w=parseInt(div.style("width"));var h=parseInt(div.style("height"));if(w<h){var diameter=parseInt(w-10);}else{var diameter=parseInt(h-10);}
this.removeDiv(container);var color=d3.scale.category20c();var tip=d3.tip(container).attr('class','d3-tip').html(function(d){return(" "+d.className+"<br><span class='valuecolor'>"+formatNumbers(d.value)+"</span> ");});var bubble=d3.layout.pack().sort(null).size([diameter,diameter]).padding(1.5);var svg=d3.select("#"+container).append("svg").attr("width",diameter).attr("height",diameter).attr("class","bubble").call(tip);var node=svg.selectAll(".node").data(bubble.nodes(classes(data)).filter(function(d){return!d.children;})).enter().append("g").attr("class","node").attr("transform",function(d){return"translate("+d.x+","+d.y+")";});if(cfg.showtips){node.on('mouseover',tip.show).on('mouseout',tip.hide);}
node.append("title").text(function(d){return d.className+": "+d.value;});node.append("circle").attr("class","circle").attr("r",function(d){return d.r;}).style("fill",function(d){return color(d.packageName);});node.append("text").text(function(d){return d.className.substr(0,40);}).style("font-size",function(d){return Math.min(2*d.r,(2*d.r-8)/this.getComputedTextLength()*10)+"px";}).attr("dy",".3em").style("text-anchor","middle");function classes(root){var classes=[];function recurse(name,node){if(node.children)node.children.forEach(function(child){recurse(node.name,child);});else classes.push({packageName:name,className:node.name,value:node.size});}
recurse(null,root);return{children:classes};}},makeChord:function(container,json,options){var cities=json[0].labels;var matrix=json[0].matrix;var cfg={title:"",showticks:true,radiusreducepercent:30,colors:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"]};if('undefined'!==typeof options){for(var i in options){if('undefined'!==typeof options[i]){cfg[i]=options[i];}}}
var div=d3.select("#"+container);var w=parseInt(div.style("width"));var h=parseInt(div.style("height"));this.removeDiv(container);var chord=d3.layout.chord().padding(.05).sortSubgroups(d3.descending).matrix(matrix);if(cfg.title.length>0){var margin={top:20,right:10,bottom:10,left:10};}else{var margin={top:0,right:10,bottom:10,left:10};}
var width=w-margin.left-margin.right;var height=h-margin.top-margin.bottom;var innerRadius=Math.min(width,height)*(cfg.radiusreducepercent/100),outerRadius=innerRadius*1.1;var fill=d3.scale.ordinal().domain(d3.range([4])).range(cfg.colors);var svg=d3.select("#"+container).append("svg").attr("width",width).attr("height",height).append("g").attr("transform","translate("+width/2+","+height/2+")");var g=svg.append("g").selectAll("path").data(chord.groups).enter().append("g").attr("class","group");g.append("path").style("fill",function(d){return fill(d.index);}).style("stroke",function(d){return fill(d.index);}).attr("d",d3.svg.arc().innerRadius(innerRadius).outerRadius(outerRadius)).on("mouseover",fade(.1)).on("mouseout",fade(1));if(cfg.showticks){var ticks=svg.append("g").selectAll("g").data(chord.groups).enter().append("g").selectAll("g").data(groupTicks).enter().append("g").attr("transform",function(d){return"rotate("+(d.angle*180/Math.PI-90)+")"
+"translate("+outerRadius+",0)";});ticks.append("line").attr("x1",1).attr("y1",0).attr("x2",5).attr("y2",0).style("stroke","#000");ticks.append("text").attr("x",8).attr("dy",".35em").attr("transform",function(d){return d.angle>Math.PI?"rotate(180)translate(-16)":null;}).style("text-anchor",function(d){return d.angle>Math.PI?"end":null;}).text(function(d){return d.label;});}
g.append("svg:text").each(function(d){d.angle=(d.startAngle+d.endAngle)/2;}).attr("dy",".35em").attr("class","titles").attr("text-anchor",function(d){return d.angle>Math.PI?"end":null;}).attr("transform",function(d){return"rotate("+(d.angle*180/Math.PI-90)+")"
+"translate("+(innerRadius+45)+")"
+(d.angle>Math.PI?"rotate(180)":"");}).text(function(d,i){return cities[i];});if(cfg.title.length>0){svg.append("g").attr("class","charttitle").append("text").attr("dy",parseInt(((h/2)*-1)+40)+"px").attr("text-anchor","middle").attr("class","charttitle").text(cfg.title);}
svg.append("g").attr("class","chord").selectAll("path").data(chord.chords).enter().append("path").attr("d",d3.svg.chord().radius(innerRadius)).style("fill",function(d){return fill(d.target.index);}).style("opacity",1);function groupTicks(d){var k=(d.endAngle-d.startAngle)/d.value;return d3.range(0,d.value,1).map(function(v,i){return{angle:v*k+d.startAngle,label:i%5?null:v};});}
function fade(opacity){return function(g,i){svg.selectAll(".chord path").filter(function(d){return d.source.index!=i&&d.target.index!=i;}).transition().style("opacity",opacity);};}},makeCirclepackage:function(container,json,options){var cfg={tickLabelFormat:".2s",showtips:true};if('undefined'!==typeof options){for(var i in options){if('undefined'!==typeof options[i]){cfg[i]=options[i];}}}
var formatNumbers=d3.format(cfg.tickLabelFormat);var data=json[0];var div=d3.select("#"+container);var w=parseInt(div.style("width"));var h=parseInt(div.style("height"));if(w<h){var diameter=parseInt(w-10);}else{var diameter=parseInt(h-10);}
this.removeDiv(container);var format=d3.format(",d");var tip=d3.tip(container).attr('class','d3-tip').html(function(d){return(" "+d.name+"<br><span class='valuecolor'>"+((format(d.size)!="NaN")?formatNumbers(d.size):"")+"</span> ");});var color=d3.scale.category20c();var pack=d3.layout.pack().size([diameter-4,diameter-4]).value(function(d){return d.size;});var svg=d3.select("#"+container).append("svg").attr("width",diameter).attr("height",diameter).append("g").attr("transform","translate(2,2)").call(tip);var node=svg.datum(data).selectAll(".node").data(pack.nodes).enter().append("g").attr("class",function(d){return d.children?"node":"leaf node";}).attr("transform",function(d){return"translate("+d.x+","+d.y+")";});if(cfg.showtips){node.on('mouseover',tip.show).on('mouseout',tip.hide);}
node.append("title").text(function(d){return d.name+(d.children?"":": "+format(d.size));});node.append("circle").attr("class","circle").style("fill",function(d){return d.children?"#fefefe":color(d.name);}).attr("r",function(d){return d.r;});node.filter(function(d){return!d.children;}).append("text").text(function(d){return d.name.substr(0,40);}).style("font-size",function(d){return Math.min(2*d.r,(2*d.r-8)/this.getComputedTextLength()*10)+"px";}).attr("dy",".3em").style("text-anchor","middle");node.filter(function(d){return d.children;}).append("text").attr('x',0).attr('y',function(d){return(d.r-15)}).style("fill","#050505").attr("dy",".5em").style("text-anchor","middle").text(function(d){return d.name.substring(0,d.r/3);});d3.select(self.frameElement).style("height",diameter+"px");},makeCircularHeatChart:function(container,data,options){var cfg={title:"",tickLabelFormat:".2s",colorRange:["white","red"],radialLabels:[],segmentLabels:[]};if('undefined'!==typeof options){for(var i in options){if('undefined'!==typeof options[i]){cfg[i]=options[i];}}}
var formatNumbers=d3.format(cfg.tickLabelFormat);var div=d3.select("#"+container);var w=parseInt(div.style("width"));var h=parseInt(div.style("height"));var innerRadius=(w*0.05);this.removeDiv(container);if(cfg.title.length>0){var margin={top:50,right:20,bottom:30,left:20};}else{var margin={top:30,right:20,bottom:30,left:20};}
var width=w-margin.left-margin.right;var height=h-margin.top-margin.bottom;var segmentHeight=parseInt((height-innerRadius)/((cfg.radialLabels.length+1)*2));var numSegments=cfg.segmentLabels.length;var tip=d3.tip(container).attr('class','d3-tip').html(function(d){return d.title+"h"+"<br><span class='valuecolor'>"+formatNumbers(d.value)+"</span> ";});var accessor=function(d){return d.value;};var ir=function(d,i){return innerRadius+Math.floor(i/numSegments)*segmentHeight;}
var or=function(d,i){return innerRadius+segmentHeight+Math.floor(i/numSegments)*segmentHeight;}
var sa=function(d,i){return(i*2*Math.PI)/numSegments;}
var ea=function(d,i){return((i+1)*2*Math.PI)/numSegments;}
var offset=innerRadius+Math.ceil(data.length/numSegments)*segmentHeight;var topoffset=margin.top-margin.bottom+100;var svg=d3.select("#"+container).append("svg").attr('width',w+margin.top+margin.bottom).attr('height',h).call(tip);var g=svg.append("g").classed("circular-heat",true).attr("transform","translate("+width/2+","+((height+topoffset)/2)+")");var domain=d3.extent(data,accessor);var color=d3.scale.linear().domain(domain).range(cfg.colorRange);var heatMap=g.selectAll("path").data(data).enter().append("path").attr("d",d3.svg.arc().innerRadius(ir).outerRadius(or).startAngle(sa).endAngle(ea)).attr("fill","#ffffff");heatMap.transition().duration(1000).attr("fill",function(d){return color(accessor(d));}).style({"opacity":0.7});var id=d3.selectAll(".circular-heat")[0].length;var lsa=0.01;var labels=svg.append("g").classed("labels",true).classed("radial",true).attr("transform","translate("+width/2+","+((height+topoffset)/2)+")");labels.selectAll("def").data(cfg.radialLabels).enter().append("def").append("path").attr("id",function(d,i){return"radial-label-path-"+id+"-"+i;}).attr("d",function(d,i){var r=innerRadius+((i+0.2)*segmentHeight);return"m"+r*Math.sin(lsa)+" -"+r*Math.cos(lsa)+" a"+r+" "+r+" 0 1 1 -1 0";});labels.selectAll("text").data(cfg.radialLabels).enter().append("text").append("textPath").attr("xlink:href",function(d,i){return"#radial-label-path-"+id+"-"+i;}).style("font-size",0.4*segmentHeight+'px').text(function(d){return d;});var segmentLabelOffset=2;var r=innerRadius+Math.ceil(data.length/numSegments)*segmentHeight+segmentLabelOffset;labels=svg.append("g").classed("labels",true).classed("segment",true).attr("transform","translate("+width/2+","+((height+topoffset)/2)+")");labels.append("def").append("path").attr("id","segment-label-path-"+id).attr("d","m0 -"+r+" a"+r+" "+r+" 0 1 1 -1 0");labels.selectAll("text").data(cfg.segmentLabels).enter().append("text").append("textPath").attr("xlink:href","#segment-label-path-"+id).attr("startOffset",function(d,i){return i*100/numSegments+"%";}).text(function(d){return d;});d3.selectAll("#"+container+" path").on('mouseover',tip.show).on('mouseout',tip.hide);if(cfg.title.length>0){svg.append("g").attr("class","charttitle").append("text").attr("x",w/2).attr("y",20).attr("text-anchor","middle").attr("class","charttitle").text(cfg.title);}},makeDonut:function(container,data,options){var cfg={title:"",tickLabelFormat:".2s",colors:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"]};if('undefined'!==typeof options){for(var i in options){if('undefined'!==typeof options[i]){cfg[i]=options[i];}}}
var formatNumbers=d3.format(cfg.tickLabelFormat);var div=d3.select("#"+container);var w=parseInt(div.style("width"));var h=parseInt(div.style("height"));this.removeDiv(container);var tip=d3.tip(container).attr('class','d3-tip').html(function(d){return(" "+d.data.label+"<br><span class='valuecolor'>"+formatNumbers(d.value)+"</span> ");});if(cfg.title.length>0){var margin={top:40,right:10,bottom:10,left:10};}else{var margin={top:20,right:10,bottom:10,left:10};}
var width=w-margin.left-margin.right;var height=h-margin.top-margin.bottom;var radius=Math.min(width,height)/2;var color=d3.scale.ordinal().range(cfg.colors);var arc=d3.svg.arc().outerRadius(radius-30).innerRadius(radius/2);var pie=d3.layout.pie().sort(null).value(function(d){return d.value;});var svg=d3.select("#"+container).append("svg").attr("width",width).attr("height",height).append("g").attr("transform","translate("+width/2+","+height/2+")").call(tip);data.forEach(function(d){d.value=+d.value;});var g=svg.selectAll(".arc").data(pie(data)).enter().append("g").attr("class","arc").style("fill","#cacaca").on('mouseover',tip.show).on('mouseout',tip.hide);g.append("path").attr("d",arc).transition().duration(500).style("fill",function(d){return color(d.data.label);});g.append("text").attr("transform",function(d){return"translate("+arc.centroid(d)+")";}).attr("dy",".35em").style("fill","#000000").style("text-anchor","middle").text(function(d){return d.data.label;});if(cfg.title.length>0){svg.append("g").attr("class","charttitle").append("text").attr("dy",parseInt(((h/2)*-1)+40)+"px").attr("text-anchor","middle").attr("class","charttitle").text(cfg.title);}},makeDotPlot:function(container,data,options){var cfg={title:"",timeformat:"%Y",outputTimeformat:"%Y",showgrid:true,colors:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"]};if('undefined'!==typeof options){for(var i in options){if('undefined'!==typeof options[i]){cfg[i]=options[i];}}}
var tip=d3.tip(container).attr('class','d3-tip').html(function(d){return d.value;});var div=d3.select("#"+container);var w=parseInt(div.style("width"));var h=parseInt(div.style("height"));this.removeDiv(container);if(cfg.title.length>0){var margin={top:75,right:100,bottom:0,left:20};}else{var margin={top:20,right:100,bottom:0,left:20};}
var width=w-margin.left-margin.right;var height=h-margin.top-margin.bottom;var parseDate=d3.time.format(cfg.timeformat).parse;var start=parseDate(d3.min(data,function(d){return d3.min(d.values,function(d){return d[0];});}));var end=parseDate(d3.max(data,function(d){return d3.max(d.values,function(d){return d[0];});}));var c=d3.scale.ordinal().range(cfg.colors);var x=d3.time.scale().range([0,width]);var xAxis=d3.svg.axis().scale(x).orient("top").tickFormat(d3.time.format(cfg.outputTimeformat));var x_grid=d3.svg.axis().scale(x).orient("bottom").tickSize(-height).tickFormat("");var svg=d3.select("#"+container).append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).style("margin-left",margin.left+"px").append("g").attr("transform","translate("+margin.left+","+margin.top+")");x.domain([start,end]);var xScale=d3.time.scale().domain([start,end]).range([0,width]);svg.append("g").attr("class","x axis").attr("transform","translate(0,"+0+")").call(xAxis);if(cfg.showgrid){svg.append("g").attr("class","x grid").attr("transform","translate(0,"+height+")").call(x_grid);}
for(var j=0;j<data.length;j++){var g=svg.append("g").attr("class","journal");var circles=g.selectAll("circle").data(data[j]['values']).enter().append("circle");var text=g.selectAll("text").data(data[j]['values']).enter().append("text");var rScale=d3.scale.linear().domain([0,d3.max(data[j]['values'],function(d){return d[1];})]).range([1,10]);circles.attr("cx",function(d,i){return xScale(parseDate(d[0]));}).attr("cy",j*25+20).attr("r",function(d){return rScale(d[1]);}).style("fill",function(d){return c(j);});text.attr("y",j*25+25).attr("x",function(d,i){return xScale(parseDate(d[0]))-5;}).attr("class","value").text(function(d){return d[1];}).style("fill","#000000").style("display","none");g.append("text").attr("y",j*25+25).attr("x",width+20).attr("class","label").text(truncate(data[j]['name'],30,"...")).style("fill","#000000").on("mouseover",mouseover).on("mouseout",mouseout);};if(cfg.title.length>0){svg.append("g").attr("class","charttitle").append("text").attr("x",width/2).attr("y",-40).attr("text-anchor","middle").attr("class","charttitle").text(cfg.title);}
function mouseover(p){var g=d3.select(this).node().parentNode;d3.select(g).selectAll("circle").style("display","none");d3.select(g).selectAll("text.value").style("display","block");}
function mouseout(p){var g=d3.select(this).node().parentNode;d3.select(g).selectAll("circle").style("display","block");d3.select(g).selectAll("text.value").style("display","none");}
function truncate(str,maxLength,suffix){if(str.length>maxLength){str=str.substring(0,maxLength+1);str=str.substring(0,Math.min(str.length,str.lastIndexOf(" ")));str=str+suffix;}
return str;}},makeDifference:function(container,data,options){var cfg={title:"",tickLabelFormat:".2s",measure:"Anzahl",timeformat:"%Y.%m",outputTimeformat:"%m/%Y",showgrid:true,labels:["v1","v2"],colors:["#67a9cf","#99d594"]};if('undefined'!==typeof options){for(var i in options){if('undefined'!==typeof options[i]){cfg[i]=options[i];}}}
var div=d3.select("#"+container);var w=parseInt(div.style("width"));var h=parseInt(div.style("height"));this.removeDiv(container);if(cfg.legend){var right=100;}else{var right=40;}
if(cfg.title.length>0){var margin={top:40,right:right,bottom:30,left:40};}else{var margin={top:20,right:right,bottom:30,left:40};}
var width=w-margin.left-margin.right;var height=h-margin.top-margin.bottom;var parseDate=d3.time.format(cfg.timeformat).parse;var x=d3.time.scale().range([0,width]);var y=d3.scale.linear().range([height,0]);var xAxis=d3.svg.axis().scale(x).orient("bottom").tickFormat(d3.time.format(cfg.outputTimeformat));var yAxis=d3.svg.axis().scale(y).tickFormat(d3.format(cfg.tickLabelFormat)).orient("left");var x_grid=d3.svg.axis().scale(x).orient("bottom").tickSize(-height).tickFormat("");var y_grid=d3.svg.axis().scale(y).orient("left").tickSize(-width).tickFormat("");var line=d3.svg.area().interpolate("basis").x(function(d){return x(d.date);}).y(function(d){return y(d.v1);});var area=d3.svg.area().interpolate("basis").x(function(d){return x(d.date);}).y1(function(d){return y(d.v1);});var svg=d3.select("#"+container).append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")");data.forEach(function(d){d.date=parseDate(d.date);d[1]=+d.v1;d[2]=+d.v2;})
x.domain(d3.extent(data,function(d){return d.date;}));y.domain([d3.min(data,function(d){return Math.min(d[1],d[2]);}),d3.max(data,function(d){return Math.max(d[1],d[2]);})]);svg.datum(data);if(cfg.showgrid){svg.append("g").attr("class","x grid").attr("transform","translate(0,"+height+")").call(x_grid);svg.append("g").attr("class","y grid").call(y_grid);}
svg.append("clipPath").attr("id","clip-below").append("path").attr("d",area.y0(height));svg.append("clipPath").attr("id","clip-above").append("path").attr("d",area.y0(0));svg.append("path").attr("class","area above").style("fill",cfg.colors[1]).attr("clip-path","url(#clip-above)").attr("d",area.y0(function(d){return y(d[2]);}));svg.append("path").attr("class","area below").style("fill",cfg.colors[0]).attr("clip-path","url(#clip-below)").attr("d",area);svg.append("path").attr("class","line").style("stroke","#000000").attr("d",line);svg.append("g").attr("class","x axis").attr("transform","translate(0,"+height+")").call(xAxis);svg.append("g").attr("class","y axis").call(yAxis).append("text").attr("transform","rotate(-90)").attr("x",-4).attr("y",7).attr("dy",".71em").style("text-anchor","end").text(cfg.measure);if(cfg.legend){var legend=svg.selectAll(".legend").data(cfg.labels).enter().append("g").attr("class","legend").attr("transform",function(d,i){return"translate(0,"+i*20+")";});legend.append("rect").attr("x",width+10).attr("width",18).attr("height",18).style("fill",function(d,i){return cfg.colors[i];});legend.append("text").attr("x",width+30).attr("y",9).attr("dy",".35em").style("text-anchor","start").text(function(d,i){return cfg.labels[i]+" >";});}
if(cfg.title.length>0){svg.append("g").attr("class","charttitle").append("text").attr("x",width/2).attr("y",-14).attr("text-anchor","middle").attr("class","charttitle").text(cfg.title);}},makeGauge:function(container,config){if(!config.label)
config.label="No title";if(!config.value)
config.value=75;if(!config.size)
config.size=175;if(!config.minorTicks)
config.minorTicks=2;if(!config.majorTicks)
config.majorTicks=5;if(!config.min)
config.min=0;if(!config.max)
config.max=100;if(!config.greenColor)
config.greenColor='#A1FF6B';if(!config.yellowColor)
config.yellowColor='#FF9900';if(!config.redColor)
config.redColor='#DC3912';var delta=parseInt((config.max-config.min)/3);if(!config.redZones)
config.redZones=[{from:config.min,to:config.min+delta}];if(!config.yellowZones)
config.yellowZones=[{from:config.min+delta,to:config.min+(delta*2)}];if(!config.greenZones)
config.greenZones=[{from:config.min+(delta*2),to:config.max}];this.removeDiv(container);var gauge=new MakeGauge(container,config);gauge.render();gauge.redraw(config.value);function MakeGauge(placeholderName,configuration){this.placeholderName=placeholderName;var self=this;this.configure=function(configuration){this.config=configuration;this.config.size=this.config.size*0.9;this.config.radius=this.config.size*0.97/2;this.config.cx=this.config.size/2;this.config.cy=this.config.size/2;this.config.min=configuration.min||0;this.config.max=configuration.max||100;this.config.range=this.config.max-this.config.min;this.config.majorTicks=configuration.majorTicks||5;this.config.minorTicks=configuration.minorTicks||2;this.config.greenColor=configuration.greenColor||"#A1FF6B";this.config.yellowColor=configuration.yellowColor||"#FF9900";this.config.redColor=configuration.redColor||"#DC3912";}
this.render=function(){this.body=d3.select("#"+this.placeholderName).append("svg:svg").attr("class","gauge").attr("width",this.config.size).attr("height",this.config.size);this.body.append("svg:circle").attr("cx",this.config.cx).attr("cy",this.config.cy).attr("r",this.config.radius).style("fill","#ccc").style("stroke","#000").style("stroke-width","0.5px");this.body.append("svg:circle").attr("cx",this.config.cx).attr("cy",this.config.cy).attr("r",0.9*this.config.radius).style("fill","#fff").style("stroke","#e0e0e0").style("stroke-width","2px");for(var index in this.config.greenZones){this.drawBand(this.config.greenZones[index].from,this.config.greenZones[index].to,self.config.greenColor);}
for(var index in this.config.yellowZones){this.drawBand(this.config.yellowZones[index].from,this.config.yellowZones[index].to,self.config.yellowColor);}
for(var index in this.config.redZones){this.drawBand(this.config.redZones[index].from,this.config.redZones[index].to,self.config.redColor);}
if(undefined!=this.config.label){var fontSize=Math.round(this.config.size/12);this.body.append("svg:text").attr("x",this.config.cx).attr("y",this.config.cy/1.75+fontSize).attr("dy",fontSize/5).attr("text-anchor","middle").text(this.config.label).style("font-size",(fontSize*0.75)+"px").style("fill","#333").style("stroke-width","0px");}
var fontSize=Math.round(this.config.size/15);var majorDelta=this.config.range/(this.config.majorTicks-1);for(var major=this.config.min;major<=this.config.max;major+=majorDelta){var minorDelta=majorDelta/this.config.minorTicks;for(var minor=major+minorDelta;minor<Math.min(major+majorDelta,this.config.max);minor+=minorDelta){var point1=this.valueToPoint(minor,0.75);var point2=this.valueToPoint(minor,0.85);this.body.append("svg:line").attr("x1",point1.x).attr("y1",point1.y).attr("x2",point2.x).attr("y2",point2.y).style("stroke","#666").style("stroke-width","1px");}
var point1=this.valueToPoint(major,0.7);var point2=this.valueToPoint(major,0.85);this.body.append("svg:line").attr("x1",point1.x).attr("y1",point1.y).attr("x2",point2.x).attr("y2",point2.y).style("stroke","#333").style("stroke-width","2px");if(major==this.config.min||major==this.config.max){var point=this.valueToPoint(major,0.63);this.body.append("svg:text").attr("x",point.x).attr("y",point.y).attr("dy",fontSize/8).attr("text-anchor",major==this.config.min?"start":"end").text(major).style("font-size",fontSize+"px").style("fill","#808080").style("stroke-width","0px");}}
var pointerContainer=this.body.append("svg:g").attr("class","pointerContainer");this.drawPointer(0);pointerContainer.append("svg:circle").attr("cx",this.config.cx).attr("cy",this.config.cy).attr("r",0.12*this.config.radius).style("fill","#4684EE").style("stroke","#666").style("opacity",1);}
this.redraw=function(value){this.drawPointer(value);}
this.drawBand=function(start,end,color){if(0>=end-start)return;this.body.append("svg:path").style("fill",color).attr("d",d3.svg.arc().startAngle(this.valueToRadians(start)).endAngle(this.valueToRadians(end)).innerRadius(0.65*this.config.radius).outerRadius(0.85*this.config.radius)).attr("transform",function(){return"translate("+self.config.cx+", "+self.config.cy+") rotate(270)"});}
this.drawPointer=function(value){var delta=this.config.range/13;var head=this.valueToPoint(value,0.85);var head1=this.valueToPoint(value-delta,0.12);var head2=this.valueToPoint(value+delta,0.12);var tailValue=value-(this.config.range*(1/(270/360))/2);var tail=this.valueToPoint(tailValue,0.28);var tail1=this.valueToPoint(tailValue-delta,0.12);var tail2=this.valueToPoint(tailValue+delta,0.12);var data=[head,head1,tail2,tail,tail1,head2,head];var line=d3.svg.line().x(function(d){return d.x}).y(function(d){return d.y}).interpolate("basis");var pointerContainer=this.body.select(".pointerContainer");var pointer=pointerContainer.selectAll("path").data([data])
pointer.enter().append("svg:path").attr("d",line).style("fill","#dc3912").style("stroke","#c63310").style("fill-opacity",0.7)
pointer.transition().attr("d",line).ease("linear")
var fontSize=Math.round(this.config.size/12);pointerContainer.selectAll("text").data([value]).text(Math.round(value)).enter().append("svg:text").attr("x",this.config.cx).attr("y",this.config.size-this.config.cy/4-fontSize).attr("dy",fontSize/2).attr("text-anchor","middle").text(Math.round(value)).style("font-size",(fontSize*0.75)+"px").style("font-weight","bold").style("fill","#000").style("stroke-width","0px");}
this.valueToDegrees=function(value){return value/this.config.range*270-45;}
this.valueToRadians=function(value){return this.valueToDegrees(value)*Math.PI/180;}
this.valueToPoint=function(value,factor){var point={x:this.config.cx-this.config.radius*factor*Math.cos(this.valueToRadians(value)),y:this.config.cy-this.config.radius*factor*Math.sin(this.valueToRadians(value))}
return point;}
this.configure(configuration);}},makeGroupedBar:function(container,data,options){var cfg={title:"",measure:"Measure",tickLabelFormat:".2s",colors:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"],showgrid:true,legend:true};if('undefined'!==typeof options){for(var i in options){if('undefined'!==typeof options[i]){cfg[i]=options[i];}}}
var div=d3.select("#"+container);var w=parseInt(div.style("width"));var h=parseInt(div.style("height"));this.removeDiv(container);var formatTipNumber=d3.format(cfg.tickLabelFormat);var tip=d3.tip(container).attr('class','d3-tip').html(function(d){return(" "+d.label+"<br><span class='valuecolor'>"+formatTipNumber(d.value)+"</span> ");});if(cfg.legend){var right=100;}else{var right=40;}
if(cfg.title.length>0){var margin={top:40,right:right,bottom:30,left:40};}else{var margin={top:20,right:right,bottom:30,left:40};}
var width=w-margin.left-margin.right;var height=h-margin.top-margin.bottom;var x0=d3.scale.ordinal().rangeRoundBands([0,width],.1);var x1=d3.scale.ordinal();var y=d3.scale.linear().range([height,0]);var color=d3.scale.ordinal().range(cfg.colors);var xAxis=d3.svg.axis().scale(x0).orient("bottom");var yAxis=d3.svg.axis().scale(y).orient("left").tickFormat(d3.format(cfg.tickLabelFormat));var x_grid=d3.svg.axis().scale(x0).orient("bottom").tickSize(-height).tickFormat("");var y_grid=d3.svg.axis().scale(y).orient("left").tickSize(-width).tickFormat("");var svg=d3.select("#"+container).append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")").call(tip);var attributeNames=d3.keys(data[0]).filter(function(key){return key!=="label";});data.forEach(function(d){d.population=attributeNames.map(function(label){return{label:label,value:+d[label]};});});x0.domain(data.map(function(d){return d.label;}));x1.domain(attributeNames).rangeRoundBands([0,x0.rangeBand()]);y.domain([0,d3.max(data,function(d){return d3.max(d.population,function(d){return d.value;});})]);svg.append("g").attr("class","x axis").attr("transform","translate(0,"+height+")").call(xAxis);svg.append("g").attr("class","y axis").call(yAxis).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text(cfg.measure);if(cfg.showgrid){svg.append("g").attr("class","x grid").attr("transform","translate(0,"+height+")").call(x_grid);svg.append("g").attr("class","y grid").call(y_grid);}
var theme=svg.selectAll(".label").data(data).enter().append("g").attr("class","g").attr("transform",function(d){return"translate("+x0(d.label)+",0)";});theme.selectAll("rect").data(function(d){return d.population;}).enter().append("rect").attr("width",x1.rangeBand()).attr("x",function(d){return x1(d.label);}).attr("y",function(d){return y(d.value);}).attr("height",function(d){return height-y(d.value);}).style("fill",function(d){return color(d.label);}).on('mouseover',tip.show).on('mouseout',tip.hide);if(cfg.legend){var legend=svg.selectAll(".legend").data(attributeNames.slice().reverse()).enter().append("g").attr("class","legend").attr("transform",function(d,i){return"translate(0,"+i*20+")";});legend.append("rect").attr("x",width+10).attr("width",18).attr("height",18).style("fill",color);legend.append("text").attr("x",width+30).attr("y",9).attr("dy",".35em").style("text-anchor","start").text(function(d){return d;});}
if(cfg.title.length>0){svg.append("g").attr("class","charttitle").append("text").attr("x",width/2).attr("y",-14).attr("text-anchor","middle").attr("class","charttitle").text(cfg.title);}},makeHierarchBar:function(container,json,options){var cfg={title:"",showtips:true,showgrid:true,tickLabelFormat:".2s",colors:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"]};if('undefined'!==typeof options){for(var i in options){if('undefined'!==typeof options[i]){cfg[i]=options[i];}}}
var data=json[0];var formatNumbers=d3.format(cfg.tickLabelFormat);var div=d3.select("#"+container);var w=parseInt(div.style("width"));var h=parseInt(div.style("height"));if(cfg.title.length>0){var margin={top:60,right:20,bottom:0,left:120};}else{var margin={top:20,right:20,bottom:0,left:120};}
var width=w-margin.left-margin.right;var height=h-margin.top-margin.bottom;this.removeDiv(container);var tip=d3.tip(container).attr('class','d3-tip').html(function(d){var txt=d.label;if(formatNumbers(d.value)!="NaN"){txt+="<br><span class='valuecolor'>"+formatNumbers(d.value)+"</span>";}
return txt;});var x=d3.scale.linear().range([0,width]),y=25,color=d3.scale.ordinal().range(cfg.colors);var hierarchy=d3.layout.partition().value(function(d){return d.value;});var xAxis=d3.svg.axis().scale(x).orient("top");var x_grid=d3.svg.axis().scale(x).orient("bottom").tickSize(-height).tickFormat(d3.format(cfg.tickLabelFormat));var svg=d3.select("#"+container).append("svg:svg").attr("width",w).attr("height",h).append("svg:g").attr("transform","translate("+margin.left+","+margin.top+")").call(tip);if(cfg.title.length>0){svg.append("g").attr("class","charttitle").append("text").attr("x",width/2).attr("dy","-40px").attr("text-anchor","middle").attr("class","charttitle").text(cfg.title);}
svg.append("svg:rect").attr("class","background").attr("width",width).attr("height",height).style("fill","#ffffff").on("click",up);svg.append("svg:g").attr("class","x axis");svg.append("g").attr("class","x grid").attr("transform","translate(0,"+height+")").call(x_grid);if(cfg.showgrid){svg.append("svg:g").attr("class","y axis").append("svg:line").attr("y1","100%");}
hierarchy.nodes(data);x.domain([0,data.value]).nice();down(data,0);function down(d,i){tip.hide;if(!d.children||this.__transition__)return;var duration=d3.event&&d3.event.altKey?7500:750,delay=duration/d.children.length;var exit=svg.selectAll(".enter").attr("class","exit");exit.selectAll("rect").filter(function(p){return p===d;}).style("fill-opacity",1e-6);var enter=bar(d).attr("transform",stack(i)).style("opacity",1);enter.select("text").style("fill-opacity",1e-6);enter.select("rect").style("fill",color(true));x.domain([0,d3.max(d.children,function(d){return d.value;})]).nice();svg.selectAll(".x.axis").transition().duration(duration).call(xAxis);var enterTransition=enter.transition().duration(duration).delay(function(d,i){return i*delay;}).attr("transform",function(d,i){return"translate(0,"+y*i*1.2+")";});enterTransition.select("text").style("fill-opacity",1);enterTransition.select("rect").attr("width",function(d){return x(d.value);}).style("fill",function(d){return color(!!d.children);});var exitTransition=exit.transition().duration(duration).style("opacity",1e-6).remove();exitTransition.selectAll("rect").attr("width",function(d){return x(d.value);});svg.select(".background").data([d]).transition().duration(duration*2);d.index=i;}
function up(d){tip.hide;if(!d.parent||this.__transition__)return;var duration=750,delay=duration/d.children.length;var exit=svg.selectAll(".enter").attr("class","exit");var enter=bar(d.parent).attr("transform",function(d,i){return"translate(0,"+y*i*1.2+")";}).style("opacity",1e-6);enter.select("rect").style("fill",function(d){return color(!!d.children);}).filter(function(p){return p===d;}).style("fill-opacity",1e-6);x.domain([0,d3.max(d.parent.children,function(d){return d.value;})]).nice();svg.selectAll(".x.axis").transition().duration(duration*2).call(xAxis);var enterTransition=enter.transition().duration(duration*2).style("opacity",1);enterTransition.select("rect").attr("width",function(d){return x(d.value);}).each("end",function(p){if(p===d)d3.select(this).style("fill-opacity",null);});var exitTransition=exit.selectAll("g").transition().duration(duration).delay(function(d,i){return i*delay;}).attr("transform",stack(d.index));exitTransition.select("text").style("fill-opacity",1e-6);exitTransition.select("rect").attr("width",function(d){return x(d.value);}).style("fill",color(true));exit.transition().duration(duration*2).remove();svg.select(".background").data([d.parent]).transition().duration(duration*2);}
function bar(d){var bar=svg.insert("svg:g",".y.axis").attr("class","enter").attr("transform","translate(0,5)").selectAll("g").data(d.children).enter().append("svg:g").style("cursor",function(d){return!d.children?null:"pointer";}).on("click",down);if(cfg.showtips){bar.on("mouseover",tip.show).on("mouseout",tip.hide);}
bar.append("svg:text").attr("x",-6).attr("y",y/2).attr("dy",".35em").attr("text-anchor","end").text(function(d){return d.label;});bar.append("svg:rect").attr("width",function(d){return x(d.value);}).attr("height",y);return bar;}
function stack(i){var x0=0;return function(d){var tx="translate("+x0+","+y*i*1.2+")";x0+=x(d.value);return tx;};}},makeHierarchPie:function(container,data,options){var cfg={title:"",showtips:true,tickLabelFormat:".2s",colors:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"]};if('undefined'!==typeof options){for(var i in options){if('undefined'!==typeof options[i]){cfg[i]=options[i];}}}
var config={hoverRadiusDiff:10,dataSchema:{valueField:'value',labelField:'label',childrenField:'children'},hoverPieAnimation:{easing:"elastic",duration:500}};var formatNumbers=d3.format(cfg.tickLabelFormat);var div=d3.select("#"+container);var w=parseInt(div.style("width"));var h=parseInt(div.style("height"));if(w>h)h=w;if(cfg.title.length>0){var margin={top:60,right:20,bottom:20,left:20};}else{var margin={top:20,right:20,bottom:20,left:20};}
var width=w-margin.left-margin.right;var height=h-margin.top-margin.bottom;var prev;this.removeDiv(container);var tip=d3.tip(container).attr('class','d3-tip').html(function(d){return(" "+d.data[config.dataSchema.labelField]+"<br><span class='valuecolor'>"+formatNumbers(d.data[config.dataSchema.valueField])+"</span> ");});var tweenPie=function(b){b.innerRadius=0;var i=d3.interpolate({startAngle:0,endAngle:0},b);return function(t){return arc(i(t));};};var rt=Math.min(width,height);if(w<h){var radius=(rt-margin.left-margin-right)/2;}else{var radius=(rt-margin.top-margin.bottom)/2;}
var inLevel=1;var dataChain=[];var color=d3.scale.ordinal().range(cfg.colors);var arc=d3.svg.arc().outerRadius(radius-config.hoverRadiusDiff).innerRadius(radius/2);var pie=d3.layout.pie().sort(null).value(function(d){var val=d[config.dataSchema.valueField];if(typeof val==='string')
return parseFloat(val);return val;});var svg=d3.select('#'+container).append("svg").attr('id','chart').attr("width",width).attr("height",height).append("g").attr("transform","translate("+radius+","+((height/2))+")").call(tip);var innerCircle=svg.append('circle').attr('class','innernav').attr("r",radius/2).attr("fill","#efefef").on("click",goLevelUp);var focusGroup=svg.append('g').attr('class','focus-group');var percentLabel=focusGroup.append('g').attr('class','arc-percent').append("text");var costLabel=focusGroup.append('g').attr('class','arc-cost').append("text").attr("dy","1.2em");if(cfg.title.length>0){svg.append("g").attr("class","charttitle").append("text").attr("dy",parseInt(((h/2)*-1)+60)+"px").attr("text-anchor","middle").attr("class","charttitle").text(cfg.title);}
renderCake(data);function goToRoot(){var inLevel=1;dataChain.length=0;renderCake(data);return false;};function goLevelUp(){if(dataChain.length==0){goToRoot();}else{inLevel--;dataChain.splice(dataChain.length-1,1);var prev=dataChain[dataChain.length-1];if(!prev){goToRoot();}else{renderCake(prev[config.dataSchema.childrenField]);}}
return false;};function pieClick(d,i){var c=arc.centroid(d);if(typeof d.data[config.dataSchema.childrenField]==='undefined')
return false;inLevel++;dataChain.push(d.data);focusGroup.attr('opacity',0);d3.select(this).attr("d",arc);renderCake(d.data[config.dataSchema.childrenField]);return false;};function updateNav(){svg.select('g.title').remove();if(dataChain.length>0){var tselection=svg.append("g").attr('class','title').append("text").attr("text-anchor","middle").attr("class","charttitle");for(var i=0;i<dataChain.length;i++){if(i==0){var splitter="";var dy=0;}else{var splitter=" / ";var dy=20;}
var txt=splitter+dataChain[i].label;tselection.append("tspan").attr("dy",dy).attr("x","0").text(txt);}}};function renderCake(data){tip.hide;svg.select('g.cake').remove();var arcs=svg.append('g').attr('class','cake').selectAll("g.arc").data(pie(data)).enter().append("g").attr("class","arc");arcs.append("path").attr("d",arc).attr("fill",function(d){return color(d.data[config.dataSchema.labelField]);}).attr("stroke",function(d){return d3.rgb(color(d.data[config.dataSchema.labelField])).darker();}).attr('class',function(d){return'category-pie-'+d.data[config.dataSchema.labelField]+(typeof d.data[config.dataSchema.childrenField]==='undefined'?' pie-leaf':'');}).on('click',pieClick).transition().ease(config.hoverPieAnimation.easing).duration(config.hoverPieAnimation.duration).attrTween("d",tweenPie);if(cfg.showtips){arcs.on('mouseover',tip.show).on('mouseout',tip.hide);}
arcs.append("text").attr("transform",function(d){return"translate("+arc.centroid(d)+")";}).attr("dy",".35em").style("fill","#000000").style("text-anchor","middle").style("font-size","0.9em").style("font-weight",function(d){if(d.data[config.dataSchema.childrenField]){return'bold';}else{return'normal';}}).text(function(d){return d.data[config.dataSchema.labelField];});arcs.append("text").attr("transform",function(d){return"translate("+arc.centroid(d)+")";}).attr("dy","2em").style("fill","#000000").style("text-anchor","middle").text(function(d){return(((d.endAngle-d.startAngle)/(2*Math.PI))*100).toFixed(1)+'%';});updateNav();};},makeMultiline:function(container,data,options){var cfg={title:"",measure:"Measure",tickLabelFormat:".2s",timeformat:"%Y%m%d",outputTimeformat:"%H:%M",showgrid:true,legend:true,colors:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"]};if('undefined'!==typeof options){for(var i in options){if('undefined'!==typeof options[i]){cfg[i]=options[i];}}}
var div=d3.select("#"+container);var w=parseInt(div.style("width"));var h=parseInt(div.style("height"));this.removeDiv(container);if(cfg.legend){var right=100;}else{var right=40;}
if(cfg.title.length>0){var margin={top:40,right:right,bottom:30,left:40};}else{var margin={top:20,right:right,bottom:30,left:40};}
var width=w-margin.left-margin.right;var height=h-margin.top-margin.bottom;var tip=d3.tip(container).attr('class','d3-tip').html(function(d){return(" "+(d.name)+" ");});var parseDate=d3.time.format(cfg.timeformat).parse;var x=d3.time.scale().range([0,width]);var y=d3.scale.linear().range([height,0]);var color=d3.scale.ordinal().range(cfg.colors);var xAxis=d3.svg.axis().scale(x).orient("bottom").tickFormat(d3.time.format(cfg.outputTimeformat));var yAxis=d3.svg.axis().scale(y).tickFormat(d3.format(cfg.tickLabelFormat)).orient("left");var x_grid=d3.svg.axis().scale(x).orient("bottom").tickSize(-height).tickFormat("");var y_grid=d3.svg.axis().scale(y).orient("left").tickSize(-width).tickFormat("");var line=d3.svg.line().interpolate("basis").x(function(d){return x(d.date);}).y(function(d){return y(d.population);});var svg=d3.select("#"+container).append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")");color.domain(d3.keys(data[0]).filter(function(key){return key!=="date";}));data.forEach(function(d){d.date=parseDate(d.date);});var themes=color.domain().map(function(name){return{name:name,values:data.map(function(d){return{date:d.date,population:+d[name]};})};});x.domain(d3.extent(data,function(d){return d.date;}));y.domain([d3.min(themes,function(c){return d3.min(c.values,function(v){return v.population;});}),d3.max(themes,function(c){return d3.max(c.values,function(v){return v.population;});})]);svg.append("g").attr("class","x axis").attr("transform","translate(0,"+height+")").call(xAxis);svg.append("g").attr("class","y axis").call(yAxis).append("text").attr("transform","rotate(-90)").attr("x",-6).attr("y",6).attr("dy",".71em").style("text-anchor","end").text(cfg.measure);if(cfg.showgrid){svg.append("g").attr("class","x grid").attr("transform","translate(0,"+height+")").call(x_grid);svg.append("g").attr("class","y grid").call(y_grid);}
var theme=svg.selectAll(".theme").data(themes).enter().append("g").attr("class","theme").call(tip);theme.append("path").attr("class","line").attr("d",function(d){return line(d.values);}).style("stroke",function(d){return color(d.name);}).on('mouseover',tip.show).on('mouseout',tip.hide);theme.append("text").datum(function(d){return{name:d.name,value:d.values[d.values.length-1]};}).attr("transform",function(d){return"translate("+x(d.value.date)+","+y(d.value.population)+")";}).attr("x",3).attr("dy",".35em").text(function(d){return d.name;});if(cfg.title.length>0){svg.append("g").attr("class","charttitle").append("text").attr("x",width/2).attr("y",-14).attr("text-anchor","middle").attr("class","charttitle").text(cfg.title);}},makeNormalizedBar:function(container,data,options){var cfg={title:"",colors:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"]};if('undefined'!==typeof options){for(var i in options){if('undefined'!==typeof options[i]){cfg[i]=options[i];}}}
var div=d3.select("#"+container);var w=parseInt(div.style("width"));var h=parseInt(div.style("height"));this.removeDiv(container);var Format=d3.format('.2r');var tip=d3.tip(container).attr('class','d3-tip').html(function(d){return(" "+d.name+"<br><span class='valuecolor'>"+Format((d.y1-d.y0)*100)+"%</span> ");});if(cfg.title.length>0){var margin={top:40,right:20,bottom:30,left:40};}else{var margin={top:20,right:20,bottom:30,left:40};}
var width=w-margin.left-margin.right;var height=h-margin.top-margin.bottom;var x=d3.scale.ordinal().rangeRoundBands([0,width],.1);var y=d3.scale.linear().rangeRound([height,0]);var color=d3.scale.ordinal().range(cfg.colors);var xAxis=d3.svg.axis().scale(x).orient("bottom");var yAxis=d3.svg.axis().scale(y).orient("left").tickFormat(d3.format(".0%"));var svg=d3.select("#"+container).append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")").call(tip);color.domain(d3.keys(data[0]).filter(function(key){return key!=="label";}));data.forEach(function(d){var y0=0;d.ages=color.domain().map(function(name){return{name:name,y0:y0,y1:y0+=+d[name]};});d.ages.forEach(function(d){d.y0/=y0;d.y1/=y0;});});data.sort(function(a,b){return b.ages[0].y1-a.ages[0].y1;});x.domain(data.map(function(d){return d.label;}));svg.append("g").attr("class","x axis").attr("transform","translate(0,"+height+")").call(xAxis);svg.append("g").attr("class","y axis").call(yAxis);var state=svg.selectAll(".label").data(data).enter().append("g").attr("class","label").attr("transform",function(d){return"translate("+x(d.label)+",0)";});state.selectAll("rect").data(function(d){return d.ages;}).enter().append("rect").attr("width",x.rangeBand()).attr("y",function(d){return y(d.y1);}).attr("height",function(d){return y(d.y0)-y(d.y1);}).style("fill",function(d){return color(d.name);}).on('mouseover',tip.show).on('mouseout',tip.hide);var legend=svg.select(".label:last-child").selectAll(".legend").data(function(d){return d.ages;}).enter().append("g").attr("class","legend").attr("transform",function(d){return"translate("+x.rangeBand()/2+","+y((d.y0+d.y1)/2)+")";});legend.append("line").attr("x2",10);legend.append("text").attr("x",50-width).attr("dy",".35em").text(function(d){return d.name;});if(cfg.title.length>0){svg.append("g").attr("class","charttitle").append("text").attr("x",width/2).attr("y",-14).attr("text-anchor","middle").attr("class","charttitle").text(cfg.title);}},makePie:function(container,data,options){var cfg={title:"",tickLabelFormat:".2s",colors:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"]};if('undefined'!==typeof options){for(var i in options){if('undefined'!==typeof options[i]){cfg[i]=options[i];}}}
var formatNumbers=d3.format(cfg.tickLabelFormat);var div=d3.select("#"+container);var w=parseInt(div.style("width"));var h=parseInt(div.style("height"));this.removeDiv(container);var tip=d3.tip(container).attr('class','d3-tip').html(function(d){return(" "+d.data.label+"<br><span class='valuecolor'>"+formatNumbers(d.value)+"</span> ");});if(cfg.title.length>0){var margin={top:40,right:10,bottom:10,left:10};}else{var margin={top:20,right:10,bottom:10,left:10};}
var width=w-margin.left-margin.right;var height=h-margin.top-margin.bottom;var radius=Math.min(width,height)/2;var color=d3.scale.ordinal().range(cfg.colors);var arc=d3.svg.arc().outerRadius(radius-30).innerRadius(0);var pie=d3.layout.pie().sort(null).value(function(d){return d.value;});var svg=d3.select("#"+container).append("svg").attr("width",width).attr("height",height).append("g").attr("transform","translate("+width/2+","+height/2+")").call(tip);data.forEach(function(d){d.value=+d.value;});var g=svg.selectAll(".arc").data(pie(data)).enter().append("g").attr("class","arc").style("fill","#cacaca").on('mouseover',tip.show).on('mouseout',tip.hide);g.append("path").attr("d",arc).transition().duration(500).style("fill",function(d){return color(d.data.label);});g.append("text").attr("transform",function(d){return"translate("+arc.centroid(d)+")";}).attr("dy",".35em").style("fill","#000000").style("text-anchor","middle").text(function(d){return d.data.label;});if(cfg.title.length>0){svg.append("g").attr("class","charttitle").append("text").attr("dy",parseInt(((h/2)*-1)+40)+"px").attr("text-anchor","middle").attr("class","charttitle").text(cfg.title);}},makeRadar:function(container,d,options){var cfg={title:"",radius:5,factor:1,factorLegend:0.1,levels:3,maxValue:1,ExtraWidth:100,tickLabelFormat:".2s",colors:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"],legendopts:[],ToRight:0,TranslateX:60,TranslateY:60,opacityArea:0.5};if('undefined'!==typeof options){for(var i in options){if('undefined'!==typeof options[i]){cfg[i]=options[i];}}}
var div=d3.select("#"+container);var w=parseInt(div.style("width"));var h=w+100;this.removeDiv(container);var radians=2*Math.PI;var Format=d3.format(cfg.tickLabelFormat);var tip=d3.tip(container).attr('class','d3-tip').html(function(d){return"<span class='valuecolor'>"+Format(d.value)+"</span>";});var margin={top:150,right:50,bottom:50,left:50};var width=w-margin.left-margin.right-cfg.ExtraWidth;var height=h-margin.top-margin.bottom-cfg.ExtraWidth;cfg.maxValue=Math.max(cfg.maxValue,d3.max(d,function(i){return d3.max(i.map(function(o){return o.value;}))}));var allAxis=(d[0].map(function(i,j){return i.label}));var total=allAxis.length;var radius=cfg.factor*Math.min(width/2,height/2);d3.select("#"+container).select("svg").remove();var g=d3.select("#"+container).append("svg").attr("width",w).attr("height",h).append("g").attr("transform","translate("+cfg.TranslateX+","+(parseInt(cfg.TranslateY)+25)+")").call(tip);var tooltip;for(var j=0;j<cfg.levels-1;j++){var levelFactor=cfg.factor*radius*((j+1)/cfg.levels);g.selectAll(".levels").data(allAxis).enter().append("svg:line").attr("x1",function(d,i){return levelFactor*(1-cfg.factor*Math.sin(i*radians/total));}).attr("y1",function(d,i){return levelFactor*(1-cfg.factor*Math.cos(i*radians/total));}).attr("x2",function(d,i){return levelFactor*(1-cfg.factor*Math.sin((i+1)*radians/total));}).attr("y2",function(d,i){return levelFactor*(1-cfg.factor*Math.cos((i+1)*radians/total));}).attr("class","line").style("stroke","grey").style("stroke-opacity","0.75").style("stroke-width","0.3px").attr("transform","translate("+(width/2-levelFactor)+", "+(height/2-levelFactor)+")");}
for(var j=0;j<cfg.levels;j++){var levelFactor=cfg.factor*radius*((j+1)/cfg.levels);g.selectAll(".levels").data([1]).enter().append("svg:text").attr("x",function(d){return levelFactor*(1-cfg.factor*Math.sin(0));}).attr("y",function(d){return levelFactor*(1-cfg.factor*Math.cos(0));}).attr("class","legend").style("font-family","sans-serif").attr("transform","translate("+(width/2-levelFactor+cfg.ToRight)+", "+(height/2-levelFactor)+")").attr("fill","#000000").text(Format((j+1)*cfg.maxValue/cfg.levels));}
series=0;d.forEach(function(y,x){dataValues=[];g.selectAll(".nodes").data(y,function(j,i){dataValues.push([width/2*(1-(parseFloat(Math.max(j.value,0))/cfg.maxValue)*cfg.factor*Math.sin(i*radians/total)),height/2*(1-(parseFloat(Math.max(j.value,0))/cfg.maxValue)*cfg.factor*Math.cos(i*radians/total))]);});dataValues.push(dataValues[0]);g.selectAll(".area").data([dataValues]).enter().append("polygon").attr("class","radar-chart-serie"+series).style("stroke-width","2px").style("stroke",cfg.colors[series]).attr("points",function(d){var str="";for(var pti=0;pti<d.length;pti++){str=str+d[pti][0]+","+d[pti][1]+" ";}
return str;}).style("fill",function(j,i){return cfg.colors[series]}).style("fill-opacity",cfg.opacityArea).on('mouseover',function(d){z="polygon."+d3.select(this).attr("class");g.selectAll("polygon").transition(200).style("fill-opacity",0.1);g.selectAll(z).transition(200).style("fill-opacity",cfg.opacityArea);}).on('mouseout',function(){g.selectAll("polygon").transition(200).style("fill-opacity",cfg.opacityArea);});series++;});series=0;d.forEach(function(y,x){g.selectAll(".nodes").data(y).enter().append("svg:circle").attr("class","radar-chart-serie"+series).attr('r',cfg.radius).attr("alt",function(j){return Math.max(j.value,0)}).attr("cx",function(j,i){dataValues.push([width/2*(1-(parseFloat(Math.max(j.value,0))/cfg.maxValue)*cfg.factor*Math.sin(i*radians/total)),height/2*(1-(parseFloat(Math.max(j.value,0))/cfg.maxValue)*cfg.factor*Math.cos(i*radians/total))]);return width/2*(1-(Math.max(j.value,0)/cfg.maxValue)*cfg.factor*Math.sin(i*radians/total));}).attr("cy",function(j,i){return height/2*(1-(Math.max(j.value,0)/cfg.maxValue)*cfg.factor*Math.cos(i*radians/total));}).attr("data-id",function(j){return j.label}).style("fill",cfg.colors[series]).style("fill-opacity",.9).on('mouseover',tip.show).on('mouseout',tip.hide).append("svg:title").text(function(j){return Format(Math.max(j.value,0))});series++;});var axis=g.selectAll(".axis").data(allAxis).enter().append("g").attr("class","axis");axis.append("line").attr("x1",width/2).attr("y1",height/2).attr("x2",function(d,i){return width/2*(1-cfg.factor*Math.sin(i*radians/total));}).attr("y2",function(d,i){return height/2*(1-cfg.factor*Math.cos(i*radians/total));}).attr("class","line").style("stroke","grey").style("stroke-width","1px");axis.append("text").attr("class","legend").text(function(d){return d}).style("font-family","sans-serif").style("fill","#000000").style("font-size","9px").attr("text-anchor","middle").attr("dy","1.25em").attr("transform",function(d,i){return"translate(0, -10)"}).attr("x",function(d,i){return width/2*(1-cfg.factorLegend*Math.sin(i*radians/total))-60*Math.sin(i*radians/total);}).attr("y",function(d,i){return height/2*(1-Math.cos(i*radians/total))-20*Math.cos(i*radians/total);});tooltip=g.append('text').style({"opacity":0,"font-size":"14px","padding-bottom":"20px","font-weight":"bold"});if(cfg.legendopts.length>0){var svg=d3.select("#"+container).selectAll('svg').append('svg').attr("width",w).attr("height",h)
if(cfg.title.length>0){var text=svg.append("text").attr("class","charttitle").attr('transform','translate(10,5)').attr("x",w/2).attr("text-anchor","middle").attr("y",24).attr("fill","#000000").text(cfg.title);}
var legend=svg.append("g").attr("class","legend").attr("height",100).attr("width",200).attr('transform','translate(10,50)');legend.selectAll('rect').data(cfg.legendopts).enter().append("rect").attr("x",0).attr("y",function(d,i){return i*15;}).attr("width",10).attr("height",10).style("fill",function(d,i){return cfg.colors[i];});legend.selectAll('text').data(cfg.legendopts).enter().append("text").attr("x",15).attr("y",function(d,i){return i*15+9;}).attr("font-size","11px").attr("fill","#737373").text(function(d){return d;});}},makeSankey:function(container,json,options){var data=json[0];var cfg={title:""};if('undefined'!==typeof options){for(var i in options){if('undefined'!==typeof options[i]){cfg[i]=options[i];}}}
var div=d3.select("#"+container);var w=parseInt(div.style("width"));var h=parseInt(div.style("height"));this.removeDiv(container);if(cfg.title.length>0){var margin={top:60,right:10,bottom:10,left:10};}else{var margin={top:10,right:10,bottom:10,left:10};}
var width=w-margin.left-margin.right;var height=h-margin.top-margin.bottom;var formatNumber=d3.format(",.0f"),format=function(d){return formatNumber(d);},color=d3.scale.category20();var svg=d3.select("#"+container).append("svg").attr("width",w).attr("height",h).append("g").attr("transform","translate("+margin.left+","+margin.top+")");if(cfg.title.length>0){svg.append("g").attr("class","charttitle").append("text").attr("x",width/2).attr("y",-30).attr("text-anchor","middle").attr("class","charttitle").text(cfg.title);}
var sankey=d3.sankey().nodeWidth(15).nodePadding(10).size([width,height]);var path=sankey.link();sankey.nodes(data.nodes).links(data.links).layout(data.links.length);var link=svg.append("g").selectAll(".link").data(data.links).enter().append("path").style({"fill":"none","stroke":"#000000","opacity":0.2}).attr("d",path).on('mouseover',function(d){var nodeSelection=d3.select(this).style({"opacity":0.5});nodeSelection.select("path").style({"opacity":1.0});}).on('mouseout',function(d){var nodeSelection=d3.select(this).style({"opacity":0.2});nodeSelection.select("path").style({"opacity":1.0});}).style("stroke-width",function(d){return Math.max(1,d.dy);}).sort(function(a,b){return b.dy-a.dy;});link.append("title").attr('class','d3-tip').text(function(d){return d.source.name+" TO "+d.target.name+"\n"+format(d.value);});var node=svg.append("g").selectAll(".node").data(data.nodes).enter().append("g").style({"cursor":"move","fill-opacity":.9,"shape-rendering":"crispEdges"}).attr("transform",function(d){return"translate("+d.x+","+d.y+")";}).call(d3.behavior.drag().origin(function(d){return d;}).on("dragstart",function(){this.parentNode.appendChild(this);}).on("drag",dragmove));node.append("rect").attr("height",function(d){return d.dy;}).attr("width",sankey.nodeWidth()).style("fill",function(d){return d.color=color(d.name.replace(/ .*/,""));}).style("stroke",function(d){return d3.rgb(d.color).darker(2);}).append("title").text(function(d){return d.name+"\n"+format(d.value);});node.append("text").attr("x",-6).attr("y",function(d){return d.dy/2;}).attr("dy",".35em").attr("text-anchor","end").attr("transform",null).text(function(d){return d.name;}).filter(function(d){return d.x<width/2;}).attr("x",6+sankey.nodeWidth()).attr("text-anchor","start");function dragmove(d){d3.select(this).attr("transform","translate("+d.x+","+(d.y=Math.max(0,Math.min(height-d.dy,d3.event.y)))+")");sankey.relayout();link.attr("d",path);}},makeScatter:function(container,data,options){var cfg={title:"",tickLabelFormat:".2s",xtitle:"wert1",ytitle:"wert2",colors:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"],legend:true,showgrid:true,min:2,max:4};if('undefined'!==typeof options){for(var i in options){if('undefined'!==typeof options[i]){cfg[i]=options[i];}}}
var div=d3.select("#"+container);var w=parseInt(div.style("width"));var h=parseInt(div.style("height"));this.removeDiv(container);if(cfg.legend){var right=100;}else{var right=40;}
if(cfg.title.length>0){var margin={top:40,right:right,bottom:30,left:40};}else{var margin={top:20,right:right,bottom:30,left:40};}
var width=w-margin.left-margin.right;var height=h-margin.top-margin.bottom;var r=d3.scale.linear().range([cfg.min,cfg.max]);var formatNumbers=d3.format(cfg.tickLabelFormat);var x=d3.scale.linear().range([0,width]);var y=d3.scale.linear().range([height,0]);var color=d3.scale.ordinal().range(cfg.colors);var tip=d3.tip(container).attr('class','d3-tip').html(function(d){return(" "+d.label+":<br><span class='valuecolor'>"+formatNumbers(d.value)+"</span> ");});var xAxis=d3.svg.axis().scale(x).tickFormat(d3.format(cfg.tickLabelFormat)).orient("bottom");var yAxis=d3.svg.axis().scale(y).tickFormat(d3.format(cfg.tickLabelFormat)).orient("left");var x_grid=d3.svg.axis().scale(x).orient("bottom").tickSize(-height).tickFormat("");var y_grid=d3.svg.axis().scale(y).orient("left").tickSize(-width).tickFormat("");var svg=d3.select("#"+container).append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")").call(tip);data.forEach(function(d){d.y=+d.y;d.x=+d.x;});x.domain(d3.extent(data,function(d){return d.x;})).nice();y.domain(d3.extent(data,function(d){return d.y;})).nice();if(cfg.showgrid){svg.append("g").attr("class","x grid").attr("transform","translate(0,"+height+")").call(x_grid);svg.append("g").attr("class","y grid").call(y_grid);}
svg.append("g").attr("class","x axis").attr("transform","translate(0,"+height+")").call(xAxis).append("text").attr("class","label").attr("x",width).attr("y",-6).style("text-anchor","end").text(cfg.xtitle);svg.append("g").attr("class","y axis").call(yAxis).append("text").attr("class","label").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text(cfg.ytitle)
var dots=svg.selectAll(".dot").data(data).enter().append("circle").attr("class","dot").attr("fill","#ffffff").attr("r",function(d){return r(d.value);}).attr("cx",function(d){return x(d.x);}).attr("cy",function(d){return y(d.y);}).on('mouseover',tip.show).on('mouseout',tip.hide);dots.transition().duration(500).style("fill",function(d){return color(d.label);});svg.append("g").attr("x",width-24).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(cfg.title);if(cfg.legend){var legend=svg.selectAll(".legend").data(color.domain()).enter().append("g").attr("class","legend").attr("transform",function(d,i){return"translate(0,"+i*20+")";});legend.append("rect").attr("x",width+10).attr("width",18).attr("height",18).style("fill",color);legend.append("text").attr("x",width+30).attr("y",9).attr("dy",".35em").style("text-anchor","start").text(function(d){return d;});}
if(cfg.title.length>0){svg.append("g").attr("class","charttitle").append("text").attr("x",width/2).attr("y",-14).attr("text-anchor","middle").attr("class","charttitle").text(cfg.title);}},makeNormalizedArea:function(container,data,options){var cfg={title:"",timeformat:"%y-%b-%d",colors:["#0000ff","#ffff00","#ff0000","#cacaca","#00ff00","#0000ff","#ffff00","#ff0000","#cacaca","#00ff00"]};if('undefined'!==typeof options){for(var i in options){if('undefined'!==typeof options[i]){cfg[i]=options[i];}}}
var div=d3.select("#"+container);var w=parseInt(div.style("width"));var h=parseInt(div.style("height"));this.removeDiv(container);if(cfg.title.length>0){var margin={top:40,right:20,bottom:30,left:40};}else{var margin={top:20,right:20,bottom:30,left:40};}
var width=w-margin.left-margin.right;var height=h-margin.top-margin.bottom;var tip=d3.tip(container).attr('class','d3-tip').html(function(d){return(" "+(d.name)+" ");});var parseDate=d3.time.format(cfg.timeformat).parse,formatPercent=d3.format(".0%");var x=d3.time.scale().range([0,width]);var y=d3.scale.linear().range([height,0]);var color=d3.scale.ordinal().range(options.colors);var xAxis=d3.svg.axis().scale(x).orient("bottom").tickFormat(d3.time.format(cfg.outputTimeformat));var yAxis=d3.svg.axis().scale(y).orient("left").tickFormat(formatPercent);var area=d3.svg.area().x(function(d){return x(d.date);}).y0(function(d){return y(d.y0);}).y1(function(d){return y(d.y0+d.y);});var stack=d3.layout.stack().values(function(d){return d.values;});var svg=d3.select("#"+container).append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")").call(tip);color.domain(d3.keys(data[0]).filter(function(key){return key!=="date";}));data.forEach(function(d){d.date=parseDate(d.date);});var themes=stack(color.domain().map(function(name){return{name:name,values:data.map(function(d){return{date:d.date,y:d[name]/100};})};}));x.domain(d3.extent(data,function(d){return d.date;}));y.domain([0,1]);var theme=svg.selectAll(".theme").data(themes).enter().append("g").attr("class","theme");theme.append("path").attr("class","area").attr("d",function(d){return area(d.values);}).style("fill",function(d){return color(d.name);}).on('mouseover',tip.show).on('mouseout',tip.hide);theme.append("text").datum(function(d){return{name:d.name,value:d.values[d.values.length-1]};}).attr("transform",function(d){return"translate("+x(d.value.date)+","+y(d.value.y0+d.value.y/2)+")";}).attr("text-anchor","left").attr("x",(width-15)*-1).attr("dy",".35em").text(function(d){return d.name;});svg.append("g").attr("class","x axis").attr("transform","translate(0,"+height+")").call(xAxis);svg.append("g").attr("class","y axis").call(yAxis);if(cfg.title.length>0){svg.append("g").attr("class","charttitle").append("text").attr("x",width/2).attr("y",-14).attr("text-anchor","middle").attr("class","charttitle").text(cfg.title);}},makeStackedArea:function(container,data,options){var cfg={title:"",tickLabelFormat:".2s",timeformat:"%y-%b-%d",outputTimeformat:"%H:%M",showgrid:true,colors:["#0000ff","#ffff00","#ff0000","#cacaca","#00ff00","#0000ff","#ffff00","#ff0000","#cacaca","#00ff00"]};if('undefined'!==typeof options){for(var i in options){if('undefined'!==typeof options[i]){cfg[i]=options[i];}}}
var div=d3.select("#"+container);var w=parseInt(div.style("width"));var h=parseInt(div.style("height"));this.removeDiv(container);if(cfg.title.length>0){var margin={top:40,right:20,bottom:30,left:40};}else{var margin={top:20,right:20,bottom:30,left:40};}
var width=w-margin.left-margin.right;var height=h-margin.top-margin.bottom;var tip=d3.tip(container).attr('class','d3-tip').html(function(d){return(" "+(d.key)+" ");});var parseDate=d3.time.format(cfg.timeformat).parse;var x=d3.time.scale().range([0,width]);var y=d3.scale.linear().range([height,0]);var color=d3.scale.ordinal().range(cfg.colors);var xAxis=d3.svg.axis().scale(x).orient("bottom").tickFormat(d3.time.format(cfg.outputTimeformat));var yAxis=d3.svg.axis().scale(y).tickFormat(d3.format(cfg.tickLabelFormat)).orient("left");var x_grid=d3.svg.axis().scale(x).orient("bottom").tickSize(-height).tickFormat("");var y_grid=d3.svg.axis().scale(y).orient("left").tickSize(-width).tickFormat("");var stack=d3.layout.stack().offset("zero").values(function(d){return d.values;}).x(function(d){return d.date;}).y(function(d){return d.value;});var nest=d3.nest().key(function(d){return d.key;});var area=d3.svg.area().interpolate("cardinal").x(function(d){return x(d.date);}).y0(function(d){return y(d.y0);}).y1(function(d){return y(d.y0+d.y);});var svg=d3.select("#"+container).append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")");data.forEach(function(d){d.date=parseDate(d.date);d.value=+d.value;});var layers=stack(nest.entries(data));x.domain(d3.extent(data,function(d){return d.date;}));y.domain([0,d3.max(data,function(d){return d.y0+d.y;})]);svg.append("g").attr("class","x axis").attr("transform","translate(0,"+height+")").call(xAxis);svg.append("g").attr("class","y axis").call(yAxis);if(cfg.showgrid){svg.append("g").attr("class","x grid").attr("transform","translate(0,"+height+")").call(x_grid);svg.append("g").attr("class","y grid").call(y_grid);}
var layer=svg.selectAll(".area").data(layers).enter().append("g").attr("class","layer").call(tip);layer.append("path").attr("class","area").attr("d",function(d){return area(d.values);}).style("fill",function(d,i){return color(i);}).on('mouseover',tip.show).on('mouseout',tip.hide);var total=0;var thisval=0;layer.append("text").attr("transform",function(d){thisval=total+(d.values[0].y/2);total=total+d.values[0].y;return"translate("+(width+margin.left-40)+","+y(thisval)+")";}).attr("x",(width-15)*-1).attr("dy",".35em").text(function(d){return d.key;});if(cfg.title.length>0){svg.append("g").attr("class","charttitle").append("text").attr("x",width/2).attr("y",-14).attr("text-anchor","middle").attr("class","charttitle").text(cfg.title);}},makeStackedBar:function(container,data,options){var cfg={title:"",measure:"Population",tickLabelFormat:".2s",legend:true,showgrid:true,colors:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"]};if('undefined'!==typeof options){for(var i in options){if('undefined'!==typeof options[i]){cfg[i]=options[i];}}}
var div=d3.select("#"+container);var w=parseInt(div.style("width"));var h=parseInt(div.style("height"));this.removeDiv(container);var formatTipNumber=d3.format(cfg.tickLabelFormat);var tip=d3.tip(container).attr('class','d3-tip').html(function(d){return(" "+d.label+"<br><span class='valuecolor'>"+formatTipNumber(d.y1-d.y0)+"</span> ");});if(cfg.legend){var right=100;}else{var right=40;}
if(cfg.title.length>0){var margin={top:40,right:right,bottom:30,left:40};}else{var margin={top:20,right:right,bottom:30,left:40};}
var width=w-margin.left-margin.right;var height=h-margin.top-margin.bottom;var x=d3.scale.ordinal().rangeRoundBands([0,width],.1);var y=d3.scale.linear().rangeRound([height,0]);var color=d3.scale.ordinal().range(cfg.colors);var xAxis=d3.svg.axis().scale(x).orient("bottom");var yAxis=d3.svg.axis().scale(y).orient("left").tickFormat(d3.format(cfg.tickLabelFormat));var x_grid=d3.svg.axis().scale(x).orient("bottom").tickSize(-height).tickFormat("");var y_grid=d3.svg.axis().scale(y).orient("left").tickSize(-width).tickFormat("");var svg=d3.select("#"+container).append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")").call(tip);color.domain(d3.keys(data[0]).filter(function(key){return key!=="label";}));data.forEach(function(d){var y0=0;d.value=color.domain().map(function(label){return{label:label,y0:y0,y1:y0+=+d[label]};});d.total=d.value[d.value.length-1].y1;});data.sort(function(a,b){return b.total-a.total;});x.domain(data.map(function(d){return d.label;}));y.domain([0,d3.max(data,function(d){return d.total;})]);svg.append("g").attr("class","x axis").attr("transform","translate(0,"+height+")").call(xAxis);svg.append("g").attr("class","y axis").call(yAxis).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text(cfg.measure);if(cfg.showgrid){svg.append("g").attr("class","x grid").attr("transform","translate(0,"+height+")").call(x_grid);svg.append("g").attr("class","y grid").call(y_grid);}
var state=svg.selectAll(".label").data(data).enter().append("g").attr("class","g").attr("transform",function(d){return"translate("+x(d.label)+",0)";});state.selectAll("rect").data(function(d){return d.value;}).enter().append("rect").attr("width",x.rangeBand()).attr("y",function(d){return y(d.y1);}).attr("height",function(d){return y(d.y0)-y(d.y1);}).style("fill",function(d){return color(d.label);}).on('mouseover',tip.show).on('mouseout',tip.hide);if(cfg.legend){var legend=svg.selectAll(".legend").data(color.domain().slice().reverse()).enter().append("g").attr("class","legend").attr("transform",function(d,i){return"translate(0,"+i*20+")";});legend.append("rect").attr("x",width+10).attr("width",18).attr("height",18).style("fill",color);legend.append("text").attr("x",width+30).attr("y",9).attr("dy",".35em").style("text-anchor","start").text(function(d){return d;});}
if(cfg.title.length>0){svg.append("g").attr("class","charttitle").append("text").attr("x",width/2).attr("y",-14).attr("text-anchor","middle").attr("class","charttitle").text(cfg.title);}},makeSteamGraph:function(container,data,options){var cfg={title:"",tickLabelFormat:".2s",timeformat:"%Y-%m-%d %H:%M:%S",outputTimeformat:"%H:%M",showgrid:true,showtips:true,colors:["#0000ff","#ffff00","#ff0000","#cacaca","#00ff00","#0000ff","#ffff00","#ff0000","#cacaca","#00ff00"]};if('undefined'!==typeof options){for(var i in options){if('undefined'!==typeof options[i]){cfg[i]=options[i];}}}
var div=d3.select("#"+container);var w=parseInt(div.style("width"));var h=parseInt(div.style("height"));this.removeDiv(container);var format=d3.time.format(cfg.timeformat);var tip=d3.tip(container).attr('class','d3-tip').html(function(d){return(" "+(d.key)+" ");});if(cfg.title.length>0){var margin={top:40,right:50,bottom:20,left:50};}else{var margin={top:20,right:50,bottom:20,left:50};}
var width=w-margin.left-margin.right;var height=h-margin.top-margin.bottom;var tip=d3.tip(container).attr('class','d3-tip').html(function(d){return(" "+(d.key)+" ");});var x=d3.time.scale().range([0,width]);var y=d3.scale.linear().range([height-10,0]);var z=d3.scale.ordinal().range(cfg.colors);var xAxis=d3.svg.axis().scale(x).orient("bottom").tickFormat(d3.time.format(cfg.outputTimeformat));var yAxis=d3.svg.axis().scale(y);var x_grid=d3.svg.axis().scale(x).orient("bottom").tickSize(-height).tickFormat("");var y_grid=d3.svg.axis().scale(y).orient("left").tickSize(-width).tickFormat("");var stack=d3.layout.stack().offset("silhouette").values(function(d){return d.values;}).x(function(d){return d.date;}).y(function(d){return d.value;});var nest=d3.nest().key(function(d){return d.key;});var area=d3.svg.area().interpolate("cardinal").x(function(d){return x(d.date);}).y0(function(d){return y(d.y0);}).y1(function(d){return y(d.y0+d.y);});var svg=d3.select("#"+container).append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")").call(tip);data.forEach(function(d){d.date=format.parse(d.date);d.value=+d.value;});var layers=stack(nest.entries(data));x.domain(d3.extent(data,function(d){return d.date;}));y.domain([0,d3.max(data,function(d){return d.y0+d.y;})]);svg.append("g").attr("class","x axis").attr("transform","translate(0,"+height+")").call(xAxis);svg.append("g").attr("class","y axis").attr("transform","translate(0, 0)").call(yAxis.orient("left"));if(cfg.showgrid){svg.append("g").attr("class","x grid").attr("transform","translate(0,"+height+")").call(x_grid);svg.append("g").attr("class","y grid").call(y_grid);}
svg.selectAll(".layer").data(layers).enter().append("path").attr("class","layer").attr("d",function(d){return area(d.values);}).style("fill",function(d,i){return z(i);});if(cfg.showtips){svg.selectAll(".layer").on('mouseover',tip.show).on('mouseout',tip.hide);}
if(cfg.title.length>0){svg.append("g").attr("class","charttitle").append("text").attr("x",width/2).attr("y",-14).attr("text-anchor","middle").attr("class","charttitle").text(cfg.title);}},makeStackedTBar:function(container,data,options){var cfg={title:"",measure:"Population",tickLabelFormat:".2s",timeformat:"%Y-%m-%d %H:%M:%S",outputTimeformat:"%H:%M",colors:["#0000ff","#ffff00","#ff0000","#cacaca","#00ff00","#0000ff","#ffff00","#ff0000","#cacaca","#00ff00"],legend:true,showgrid:true};if('undefined'!==typeof options){for(var i in options){if('undefined'!==typeof options[i]){cfg[i]=options[i];}}}
var div=d3.select("#"+container);var w=parseInt(div.style("width"));var h=parseInt(div.style("height"));this.removeDiv(container);if(cfg.title.length>0){var margin={top:40,right:20,bottom:30,left:40};}else{var margin={top:20,right:20,bottom:30,left:40};}
var width=w-margin.left-margin.right;var height=h-margin.top-margin.bottom;var parseDate=d3.time.format(cfg.timeformat).parse;var formatNumbers=d3.format(cfg.tickLabelFormat);var tip=d3.tip(container).attr('class','d3-tip').html(function(d){return(" "+d.label+"<br><span class='valuecolor'>"+formatNumbers(d.y1-d.y0)+"</span> ");});var color=d3.scale.ordinal().range(options.colors);var xl=d3.time.scale().range([0,width]);var x=d3.scale.ordinal().rangeRoundBands([0,width],.1);var y=d3.scale.linear().rangeRound([height,0]);var xAxis=d3.svg.axis().scale(xl).orient("bottom").tickFormat(d3.time.format(cfg.outputTimeformat));var yAxis=d3.svg.axis().scale(y).tickFormat(d3.format(cfg.tickLabelFormat)).orient("left");var x_grid=d3.svg.axis().scale(x).orient("bottom").tickSize(-height).tickFormat("");var y_grid=d3.svg.axis().scale(y).orient("left").tickSize(-width).tickFormat("");var svg=d3.select("#"+container).append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")").call(tip);color.domain(d3.keys(data[0]).filter(function(key){return key!=="date";}));data.forEach(function(d){d.date=parseDate(d.date);var y0=0;d.value=color.domain().map(function(date){return{label:date,y0:y0,y1:y0+=+d[date]};});d.total=d.value[d.value.length-1].y1;});xl.domain(d3.extent(data,function(d){return d.date;}));x.domain(data.map(function(d){return d.date;}));y.domain([0,d3.max(data,function(d){return d.total;})]);svg.append("g").attr("class","x axis").attr("transform","translate(0,"+height+")").call(xAxis);svg.append("g").attr("class","y axis").call(yAxis).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text(cfg.measure);if(cfg.showgrid){svg.append("g").attr("class","x grid").attr("transform","translate(0,"+height+")").call(x_grid);svg.append("g").attr("class","y grid").call(y_grid);}
var theme=svg.selectAll(".label").data(data).enter().append("g").attr("class","g").attr("transform",function(d){return"translate("+x(d.date)+",0)";});theme.selectAll("rect").data(function(d){return d.value;}).enter().append("rect").attr("width",x.rangeBand()).attr("y",function(d){return y(d.y1);}).attr("height",function(d){return y(d.y0)-y(d.y1);}).style("fill",function(d){return color(d.label);}).on('mouseover',tip.show).on('mouseout',tip.hide);if(cfg.legend){var legend=svg.selectAll(".legend").data(color.domain().slice().reverse()).enter().append("g").attr("class","legend").attr("transform",function(d,i){return"translate(0,"+i*20+")";});legend.append("rect").attr("x",width-18).attr("width",18).attr("height",18).style("fill",color);legend.append("text").attr("x",width-24).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(d){return d;});}
if(cfg.title.length>0){svg.append("g").attr("class","charttitle").append("text").attr("x",width/2).attr("y",-14).attr("text-anchor","middle").attr("class","charttitle").text(cfg.title);}},makeBoxHeatchart:function(container,data,options){var cfg={title:"",classes:5,tickLabelFormat:".2s",days:["Mo","Tu","We","Th","Fr","Sa","Su"],times:["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24"],colors:["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"]};if('undefined'!==typeof options){for(var i in options){if('undefined'!==typeof options[i]){cfg[i]=options[i];}}}
var formatNumbers=d3.format(cfg.tickLabelFormat);var tip=d3.tip(container).attr('class','d3-tip').html(function(d){return"<span class='valuecolor'>"+formatNumbers(d.value)+"</span>";});var div=d3.select("#"+container);var w=parseInt(div.style("width"));var h=parseInt(div.style("height"));this.removeDiv(container);if(cfg.title.length>0){var margin={top:50,right:20,bottom:30,left:40};}else{var margin={top:30,right:20,bottom:30,left:40};}
var width=w-margin.left-margin.right;var height=h-margin.top-margin.bottom;var gridSize=Math.floor(width/24),legendElementWidth=gridSize*2,classes=cfg.classes,colors=cfg.colors,days=cfg.days,times=cfg.times;var colorScale=d3.scale.quantile().domain([0,classes-1,d3.max(data,function(d){return d.value;})]).range(colors);var svg=d3.select("#"+container).append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")").call(tip);var dayLabels=svg.selectAll(".dayLabel").data(days).enter().append("text").text(function(d){return d;}).attr("x",0).attr("y",function(d,i){return i*gridSize;}).style("text-anchor","end").attr("transform","translate(-6,"+gridSize/1.5+")").attr("class",function(d,i){return((i>=0&&i<=4)?"dayLabel mono axis axis-workweek":"dayLabel mono axis");});var timeLabels=svg.selectAll(".timeLabel").data(times).enter().append("text").text(function(d){return d;}).attr("x",function(d,i){return i*gridSize;}).attr("y",0).style("text-anchor","middle").attr("transform","translate("+gridSize/2+", -6)").attr("class",function(d,i){return((i>=7&&i<=16)?"timeLabel mono axis axis-worktime":"timeLabel mono axis");});var heatMap=svg.selectAll(".hour").data(data).enter().append("rect").attr("x",function(d){return(d.hour-1)*gridSize;}).attr("y",function(d){return(d.day-1)*gridSize;}).attr("rx",4).attr("ry",4).attr("class","hour bordered").attr("width",gridSize).attr("height",gridSize).style("fill","#cecece").on('mouseover',tip.show).on('mouseout',tip.hide);heatMap.transition().duration(1000).style("fill",function(d){return colorScale(d.value);});heatMap.append("title").text(function(d){return d.value;});var legend=svg.selectAll(".legend").data([0].concat(colorScale.quantiles()),function(d){return d;}).enter().append("g").attr("class","legend");legend.append("rect").attr("x",function(d,i){return legendElementWidth*i;}).attr("y",parseInt((cfg.days.length+1)*gridSize)).attr("width",legendElementWidth).attr("height",gridSize/2).style("fill",function(d,i){return colors[i];});legend.append("text").attr("class","mono").text(function(d){return Math.round(d);}).attr("x",function(d,i){return legendElementWidth*i;}).attr("y",parseInt((cfg.days.length+1)*gridSize)+gridSize);if(cfg.title.length>0){svg.append("g").attr("class","charttitle").append("text").attr("x",width/2).attr("y",-24).attr("text-anchor","middle").attr("class","charttitle").text(cfg.title);}},makeWordCloud:function(container,data,options){var cfg={font:"Impact",orientations:3,angleFrom:90,angleTo:90,padding:1,minimum:1,colors:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"]};if('undefined'!==typeof options){for(var i in options){if('undefined'!==typeof options[i]){cfg[i]=options[i];}}}
if(data[0]['text']){}else{data.sort();var myBlocks=new Object;for(var i=0;i<data.length;i++){var aBlock=data[i];if(myBlocks.hasOwnProperty(aBlock)){myBlocks[aBlock]++;}else{myBlocks[aBlock]=1;}}
var wordlist=new Array();for(var key in myBlocks){var value=myBlocks[key];if(value>=cfg.minimum){var thisword=new Object();thisword.text=key;thisword.size=value;wordlist.push(thisword);}}
data=wordlist;}
var div=d3.select("#"+container);var w=parseInt(div.style("width"));var h=parseInt(div.style("height"));this.removeDiv(container);var fill=d3.scale.ordinal().range(cfg.colors);var fontSize=d3.scale.log().range([12,100]);d3.layout.cloud().size([w,h]).words(data.map(function(d){return{text:d.text,size:d.size};})).padding(cfg.padding).size([w,h]).rotate(function(){return~~(Math.random()*cfg.orientations)*cfg.angleFrom-cfg.angleTo;}).font(cfg.font).fontSize(function(d){return fontSize(d.size);}).on("end",draw).start();function draw(words){d3.select("#"+container).append("svg").attr("width",w).attr("height",h).append("g").attr("transform","translate("+(w/2)+","+(h/2)+")").selectAll("text").data(words).enter().append("text").style("font-size",function(d){return d.size+"px";}).style("font-family",cfg.font).style("fill",function(d,i){return fill(i);}).attr("text-anchor","middle").attr("transform",function(d){return"translate("+[d.x,d.y]+")rotate("+d.rotate+")";}).text(function(d){return d.text;});}},makeTree:function(container,json){var data=json[0];var div=d3.select("#"+container);var width=parseInt(div.style("width"));var height=parseInt(div.style("height"));this.removeDiv(container);var m=[20,120,20,120],w=width-m[1]-m[3],h=height-m[0]-m[2],i=0;var tree=d3.layout.tree().size([h,w]);var diagonal=d3.svg.diagonal().projection(function(d){return[d.y,d.x];});var vis=d3.select("#"+container).append("svg:svg").attr("width",width+m[1]+m[3]).attr("height",height+m[0]+m[2]).append("svg:g").attr("transform","translate("+m[3]+","+m[0]+")");data.x0=h/2;data.y0=0;function toggleAll(d){if(d.children){d.children.forEach(toggleAll);toggle(d);}}
data.children.forEach(toggleAll);update(data);function update(source){var duration=d3.event&&d3.event.altKey?5000:500;var nodes=tree.nodes(data).reverse();nodes.forEach(function(d){d.y=d.depth*180;});var node=vis.selectAll("g.node").data(nodes,function(d){return d.id||(d.id=++i);});var nodeEnter=node.enter().append("svg:g").attr("class","node").attr("transform",function(d){return"translate("+source.y0+","+source.x0+")";}).on("click",function(d){toggle(d);update(d);});nodeEnter.append("svg:circle").attr("r",1e-6).style("fill",function(d){return d._children?"lightsteelblue":"#ffffff";});nodeEnter.append("svg:text").attr("x",function(d){return d.children||d._children?-10:10;}).attr("dy",".35em").attr("text-anchor",function(d){return d.children||d._children?"end":"start";}).text(function(d){return d.name;}).style("fill-opacity",1e-6);var nodeUpdate=node.transition().duration(duration).attr("transform",function(d){return"translate("+d.y+","+d.x+")";});nodeUpdate.select("circle").attr("r",4.5).style("fill",function(d){return d._children?"lightsteelblue":"#cacaca";});nodeUpdate.select("text").style("fill-opacity",1);var nodeExit=node.exit().transition().duration(duration).attr("transform",function(d){return"translate("+source.y+","+source.x+")";}).remove();nodeExit.select("circle").attr("r",1e-6);nodeExit.select("text").style("fill-opacity",1e-6);var link=vis.selectAll("path.link").data(tree.links(nodes),function(d){return d.target.id;});link.enter().insert("svg:path","g").attr("class","link").attr("fill","none").attr("stroke","#000").attr("stroke-opacity",".2").attr("stroke-width",function(d){return d.size;}).attr("d",function(d){var o={x:source.x0,y:source.y0};return diagonal({source:o,target:o});}).transition().duration(duration).attr("d",diagonal);link.transition().duration(duration).attr("d",diagonal);link.exit().transition().duration(duration).attr("d",function(d){var o={x:source.x,y:source.y};return diagonal({source:o,target:o});}).remove();nodes.forEach(function(d){d.x0=d.x;d.y0=d.y;});}
function toggle(d){if(d.children){d._children=d.children;d.children=null;}else{d.children=d._children;d._children=null;}}},makeTreemap:function(container,data,options){var cfg={tickLabelFormat:".2s",};if('undefined'!==typeof options){for(var i in options){if('undefined'!==typeof options[i]){cfg[i]=options[i];}}}
var formatNumbers=d3.format(cfg.tickLabelFormat);var jdata=data[0];var div=d3.select("#"+container);var width=parseInt(div.style("width"));var height=parseInt(div.style("height"));this.removeDiv(container);var w=width,h=height,color=d3.scale.category20c();var tip=d3.tip(container).attr('class','d3-tip').html(function(d){return(" "+d.key+"<br><span class='valuecolor'>"+formatNumbers(d.value)+"</span> ");});var treemap=d3.layout.treemap().size([w+1,h+1]).children(function(d){return isNaN(d.value)?d3.entries(d.value):null;}).value(function(d){return d.value;}).sticky(true);var svg=d3.select("#"+container).append("svg").style("width",w+"px").style("height",h+"px").append("g").attr("transform","translate(-.5,-.5)").call(tip);var cell=svg.data(d3.entries([jdata])).selectAll("g").data(treemap).enter().append("g").style({"opacity":1}).attr("transform",function(d){return"translate("+d.x+","+d.y+")";}).on('mouseover',tip.show).on('mouseout',tip.hide);cell.append("rect").attr("width",function(d){return d.dx+"px";}).attr("height",function(d){return d.dy+"px";}).style("fill",function(d){return color(d.key);});cell.append("text").attr("x",function(d){return d.dx/2;}).attr("y",function(d){return d.dy/2;}).attr("dy",".35em").style("color","#000000").attr("text-anchor","middle").style("font-size","0.9em").style("font-weight","bold").text(function(d){return d.children?null:d.key;});cell.append("title").text(function(d){return d.key+": "+d.value;});},makeTreemapZoom:function(container,data,options){var cfg={tickLabelFormat:".2s",showtips:true};if('undefined'!==typeof options){for(var i in options){if('undefined'!==typeof options[i]){cfg[i]=options[i];}}}
var formatNumbers=d3.format(cfg.tickLabelFormat);var jdata=data[0];var div=d3.select("#"+container);var w=parseInt(div.style("width"));var h=parseInt(div.style("height"));this.removeDiv(container);var tip=d3.tip(container).attr('class','d3-tip').html(function(d){return(" "+d.name+"<br><span class='valuecolor'>"+formatNumbers(d.value)+"</span> ");});var margin={top:20,right:0,bottom:0,left:0},width=w,height=h-margin.top-margin.bottom,color=d3.scale.category20c(),transitioning;var x=d3.scale.linear().domain([0,width]).range([0,width]);var y=d3.scale.linear().domain([0,height]).range([0,height]);var treemap=d3.layout.treemap().children(function(d,depth){return depth?null:d._children;}).sort(function(a,b){return a.value-b.value;}).ratio(height/width*0.5*(1+Math.sqrt(5))).round(false);var svg=d3.select("#"+container).append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.bottom+margin.top).style("margin-left",-margin.left+"px").style("margin.right",-margin.right+"px").append("g").attr("transform","translate("+margin.left+","+margin.top+")").style("shape-rendering","crispEdges").call(tip);var grandparent=svg.append("g").attr("class","grandparent");grandparent.append("rect").attr("y",-margin.top).attr("width",width).style("fill","#cacaca").attr("height",margin.top);grandparent.append("text").attr("x",6).attr("y",6-margin.top).attr("dy",".75em");root=jdata;initialize(root);accumulate(root);layout(root);display(root);function initialize(root){root.x=root.y=0;root.dx=width;root.dy=height;root.depth=0;}
function accumulate(d){return(d._children=d.children)?d.value=d.children.reduce(function(p,v){return p+accumulate(v);},0):d.value;}
function layout(d){if(d._children){treemap.nodes({_children:d._children});d._children.forEach(function(c){c.x=d.x+c.x*d.dx;c.y=d.y+c.y*d.dy;c.dx*=d.dx;c.dy*=d.dy;c.parent=d;layout(c);});}}
function display(d){grandparent.datum(d.parent).on("click",transition).select("text").text(name(d));var g1=svg.insert("g",".grandparent").datum(d).attr("class","depth");var g=g1.selectAll("g").data(d._children).enter().append("g");g.filter(function(d){return d._children;}).classed("children",true).on("click",transition);g.selectAll(".child").data(function(d){return d._children||[d];}).enter().append("rect").attr("class","child").call(rect);g.append("rect").attr("class","parent").style("fill",function(d){return color(d.name);}).call(rect);if(cfg.showtips){g.selectAll("rect").on('mouseover',tip.show).on('mouseout',tip.hide);}
g.append("text").style("fill","#000000").style("text-anchor","middle").style("font-size","0.9em").style("font-weight","bold").text(function(d){return d.name;}).call(text);function transition(d){if(transitioning||!d)return;transitioning=true;var g2=display(d),t1=g1.transition().duration(750),t2=g2.transition().duration(750);x.domain([d.x,d.x+d.dx]);y.domain([d.y,d.y+d.dy]);svg.style("shape-rendering",null);svg.selectAll(".depth").sort(function(a,b){return a.depth-b.depth;});g2.selectAll("text").style("fill-opacity",0);t1.selectAll("text").call(text).style("fill-opacity",0);t2.selectAll("text").call(text).style("fill-opacity",1);t1.selectAll("rect").call(rect);t2.selectAll("rect").call(rect);t1.remove().each("end",function(){svg.style("shape-rendering","crispEdges");transitioning=false;});}
tip.hide;return g;}
function text(text){text.attr("x",function(d){return x(d.x)+((x(d.x+d.dx)-x(d.x))/2);}).attr("y",function(d){return y(d.y)+((y(d.y+d.dy)-y(d.y))/2);});}
function rect(rect){rect.attr("x",function(d){return x(d.x);}).attr("y",function(d){return y(d.y);}).attr("width",function(d){return x(d.x+d.dx)-x(d.x);}).attr("height",function(d){return y(d.y+d.dy)-y(d.y);});}
function name(d){return d.parent?name(d.parent)+" / "+d.name:d.name;}},makeWaterfall:function(container,data,options){var cfg={title:"",measure:"Events",tickLabelFormat:".2s",showgrid:true,legend:true,colors:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"]};if('undefined'!==typeof options){for(var i in options){if('undefined'!==typeof options[i]){cfg[i]=options[i];}}}
var formatNumber=d3.format(cfg.tickLabelFormat);var div=d3.select("#"+container);var w=parseInt(div.style("width"));var h=parseInt(div.style("height"));this.removeDiv(container);var tip=d3.tip(container).attr('class','d3-tip').html(function(d){return(" <span class='valuecolor'>"+formatNumber(d.value)+"</span> ");});if(cfg.legend){var right=100;}else{var right=40;}
if(cfg.title.length>0){var margin={top:40,right:right,bottom:30,left:40};}else{var margin={top:20,right:right,bottom:30,left:40};}
var width=w-margin.left-margin.right;var height=h-margin.top-margin.bottom;var x0=d3.scale.ordinal().rangeRoundBands([0,width],0,.1);var x1=d3.scale.ordinal();var y=d3.scale.linear().range([height,0]);var color=d3.scale.ordinal().range(cfg.colors);var xAxis=d3.svg.axis().scale(x0).orient("bottom");var yAxis=d3.svg.axis().scale(y).orient("left").tickFormat(d3.format(cfg.tickLabelFormat));var x_grid=d3.svg.axis().scale(x0).orient("bottom").tickSize(-height).tickFormat("");var y_grid=d3.svg.axis().scale(y).orient("left").tickSize(-width).tickFormat("");var svg=d3.select("#"+container).append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")").call(tip);var categories=d3.keys(data[0]).filter(function(key){return key!=="period";});data.forEach(function(d){total=0
totals={}
for(var i=0;i<categories.length;i++){if(i==3){total=total-+d[categories[i]];totals[categories[i]]=total;}
else{totals[categories[i]]=total;total+=+d[categories[i]];}}
d.formatted=categories.map(function(category){return{name:category,value:+d[category],baseHeight:+totals[category]};});});x0.domain(data.map(function(d){return d.period;}));x1.domain(categories).rangeRoundBands([0,x0.rangeBand()]);y.domain([0,d3.max(data,function(d){return d3.max(d.formatted,function(d){return d.value+d.baseHeight;});})]);svg.append("g").attr("class","x axis").attr("transform","translate(0,"+height+")").call(xAxis);svg.append("g").attr("class","y axis").call(yAxis).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text(cfg.measure);if(cfg.showgrid){svg.append("g").attr("class","x grid").attr("transform","translate(0,"+height+")").call(x_grid);svg.append("g").attr("class","y grid").call(y_grid);}
var state=svg.selectAll(".state").data(data).enter().append("g").attr("class","g").attr("transform",function(d){return"translate("+x0(d.period)+",0)";});state.selectAll("rect").data(function(d){return d.formatted;}).enter().append("rect").attr("width",x1.rangeBand()).attr("x",function(d){return x1(d.name);}).attr("y",function(d){return y(d.value+d.baseHeight);}).attr("height",function(d){return height-y(d.value);}).style("fill",function(d){return color(d.name);}).on('mouseover',tip.show).on('mouseout',tip.hide);var legend=svg.selectAll(".legend").data(categories.slice()).enter().append("g").attr("class","legend").attr("transform",function(d,i){return"translate(0,"+i*20+")";});legend.append("rect").attr("x",width+10).attr("width",18).attr("height",18).style("fill",color);legend.append("text").attr("x",width+30).attr("y",9).attr("dy",".35em").style("text-anchor","start").text(function(d){return d;});if(cfg.title.length>0){svg.append("g").attr("class","charttitle").append("text").attr("x",width/2).attr("y",-14).attr("text-anchor","middle").attr("class","charttitle").text(cfg.title);}},makeWheel:function(container,json){var div=d3.select("#"+container);var w=parseInt(div.style("width"))-25;this.removeDiv(container);var width=w,height=w,radius=w/2,x=d3.scale.linear().range([0,2*Math.PI]),y=d3.scale.pow().exponent(1.3).domain([0,1]).range([0,radius]),padding=5,duration=1000;var vis=div.append("svg").attr("width",width+padding*2).attr("height",height+padding*2).append("g").attr("transform","translate("+[radius+padding,radius+padding]+")");var partition=d3.layout.partition().sort(null).value(function(d){return 5.8-d.depth;});var arc=d3.svg.arc().startAngle(function(d){return Math.max(0,Math.min(2*Math.PI,x(d.x)));}).endAngle(function(d){return Math.max(0,Math.min(2*Math.PI,x(d.x+d.dx)));}).innerRadius(function(d){return Math.max(0,d.y?y(d.y):d.y);}).outerRadius(function(d){return Math.max(0,y(d.y+d.dy));});var nodes=partition.nodes({children:json});var path=vis.selectAll("path").data(nodes);path.enter().append("path").attr("id",function(d,i){return"path-"+i;}).attr("d",arc).attr("fill-rule","evenodd").style("fill",color).on("click",click);var text=vis.selectAll("text").data(nodes);var textEnter=text.enter().append("text").style("fill-opacity",1).style("fill",function(d){return brightness(d3.rgb(color(d)))<125?"#eee":"#000";}).attr("text-anchor",function(d){return x(d.x+d.dx/2)>Math.PI?"end":"start";}).attr("dy",".2em").attr("transform",function(d){var multiline=(d.name||"").split(" ").length>1,angle=x(d.x+d.dx/2)*180/Math.PI-90,rotate=angle+(multiline?-.5:0);return"rotate("+rotate+")translate("+(y(d.y)+padding)+")rotate("+(angle>90?-180:0)+")";}).on("click",click);textEnter.append("tspan").attr("x",0).on("click",link).text(function(d){return d.depth?d.name.split(" ")[0]:"";});textEnter.append("tspan").attr("x",0).attr("dy","1em").on("click",link).text(function(d){return d.depth?d.name.split(" ")[1]||"":"";});function link(d){if(d.link)
location.href=d.link,"_blank";}
function click(d){path.transition().duration(duration).attrTween("d",arcTween(d));text.style("visibility",function(e){return isParentOf(d,e)?null:d3.select(this).style("visibility");}).transition().duration(duration).attrTween("text-anchor",function(d){return function(){return x(d.x+d.dx/2)>Math.PI?"end":"start";};}).attrTween("transform",function(d){var multiline=(d.name||"").split(" ").length>1;return function(){var angle=x(d.x+d.dx/2)*180/Math.PI-90,rotate=angle+(multiline?-.5:0);return"rotate("+rotate+")translate("+(y(d.y)+padding)+")rotate("+(angle>90?-180:0)+")";};}).style("fill-opacity",function(e){return isParentOf(d,e)?1:1e-6;}).each("end",function(e){d3.select(this).style("visibility",isParentOf(d,e)?null:"hidden");});}
function isParentOf(p,c){if(p===c)return true;if(p.children){return p.children.some(function(d){return isParentOf(d,c);});}
return false;}
function color(d){if(d.children){var colors=d.children.map(color),a=d3.hsl(colors[0]),b=d3.hsl(colors[1]);return d3.hsl((a.h+b.h)/2,a.s*1.2,a.l/1.2);}
return d.color||"#fff";}
function arcTween(d){var my=maxY(d),xd=d3.interpolate(x.domain(),[d.x,d.x+d.dx]),yd=d3.interpolate(y.domain(),[d.y,my]),yr=d3.interpolate(y.range(),[d.y?20:0,radius]);return function(d){return function(t){x.domain(xd(t));y.domain(yd(t)).range(yr(t));return arc(d);};};}
function maxY(d){return d.children?Math.max.apply(Math,d.children.map(maxY)):d.y+d.dy;}
function brightness(rgb){return rgb.r*.299+rgb.g*.587+rgb.b*.114;}},makeMapThematic:function(container,data,options){var cfg={title:"",measure:"",classes:3,projection:"ortho",grid:true,showtips:true,tickLabelFormat:".2s",legend:true,geojson:"world.json",colors:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"],nodatacolor:"#000000"};if('undefined'!==typeof options){for(var i in options){if('undefined'!==typeof options[i]){cfg[i]=options[i];}}}
var toggleMove=false;var formatNumber=d3.format(cfg.tickLabelFormat);var div=d3.select("#"+container);var w=parseInt(div.style("width"));var h=parseInt(div.style("height"));this.removeDiv(container);var tip=d3.tip(container).attr('class','d3-tip').html(function(d){var val=formatNumber(rateById.get(d.id));var txt=d["properties"].name;if(val!="NaN"){txt+="<br><span class='valuecolor'>"+formatNumber(rateById.get(d.id))+"</span>";}
return txt;});if(cfg.legend){var right=150;}else{var right=0;}
if(cfg.title.length>0){var margin={top:30,right:right,bottom:0,left:0};}else{var margin={top:0,right:right,bottom:0,left:0};}
var width=w-margin.left-margin.right;var height=h-margin.top-margin.bottom;var rt=Math.min(width,height);var rateById=d3.map();var v=[];data.forEach(function(d){rateById.set(d[0],+d[1]);v.push(d[1]);});var quantize=d3.scale.quantile().domain(v).range(d3.range(cfg.classes).map(function(i){return cfg.colors[i];}));var svg=d3.select("#"+container).append("svg").attr("width",w).attr("height",h).attr("transform","translate("+margin.left+","+margin.top+")");var map=svg.append("svg").attr("id","map").attr("class","map").attr("x",margin.left).attr("y",margin.top).attr("width",width).attr("height",height).call(tip);switch(cfg.projection){case"mercator":var projection=d3.geo.mercator().rotate([0,0]);break;case"ortho":var projection=d3.geo.orthographic().translate([width/2,height/2]).clipAngle(90);var a=d3.scale.linear().domain([0,width]).range([-180,180]);var b=d3.scale.linear().domain([0,height]).range([90,-90]);}
var scale=projection.scale();var origin=[width/2,height/2];var path=d3.geo.path().projection(projection);var g=map.append("g");if(cfg.grid){var graticule=d3.geo.graticule();g.append("path").attr("class","graticule").datum(graticule).attr("d",path);g.append("path").attr("class","foreground").datum(graticule.outline).attr("d",path);}
var feature=g.selectAll(".feature");d3.json(cfg.geojson,function(collection){feature=feature.data(collection.features).enter().append("path").attr("class","country").style("fill",function(d){var res=rateById.get(d.id);if(res){return quantize(res);}else{return cfg.nodatacolor;}}).attr("d",path);if(cfg.showtips){feature.on('mouseover',tip.show).on('mouseout',tip.hide);}});if(cfg.title.length>0){svg.append("g").attr("class","charttitle").append("text").attr("x",w/2).attr("y",18).attr("text-anchor","middle").attr("class","charttitle").text(cfg.title);}
if(cfg.legend){var legend=svg.append("g").attr("class","legend");legend.append("text").attr("x",width+15).attr("y",margin.top+5).attr("dy",".35em").style("text-anchor","start").text(cfg.measure);var c=cfg.colors;var q=quantize.quantiles();var minval=d3.min(v);var maxval=d3.max(v);for(var i=0;i<cfg.classes;i++){if(i==0){var at=formatNumber(minval);var bt=formatNumber(q[0]);var st="";}else{if(i==cfg.classes-1){var at=formatNumber(q[i-1]);var bt=formatNumber(maxval);var st="> ";}else{var at=formatNumber(q[i-1]);var bt=formatNumber(q[i]);var st="> ";}}
if(at==bt){var txt=at;}else{var txt=st+at+" - "+bt;}
legend.append("rect").attr("x",width+15).attr("y",20*(i+1)+margin.top).attr("width",18).attr("height",18).style("fill",c[i]);legend.append("text").attr("x",width+40).attr("y",20*(i+1)+10+margin.top).attr("dy",".35em").style("text-anchor","start").text(txt);}
legend.append("rect").attr("x",width+15).attr("y",20*(i+1)+margin.top).attr("width",18).attr("height",18).style("fill",cfg.nodatacolor);legend.append("text").attr("x",width+40).attr("y",20*(i+1)+10+margin.top).attr("dy",".35em").style("text-anchor","start").text("No data");}
if(cfg.projection=="ortho"){svg.on("mousemove",function(){if(toggleMove){var p=d3.mouse(this);projection.rotate([a(p[0]),b(p[1])]);origin=[a(p[0]),b(p[1])];svg.selectAll("path").attr("d",path);}});svg.on("click",function(){if(toggleMove){toggleMove=false;scale=d3.event.scale;}else{toggleMove=true;}});}
var zoom=d3.behavior.zoom().on("zoom",function(){if(d3.event){origin=[d3.event.translate[0]*-1,d3.event.translate[1]];g.attr("transform","translate("+
d3.event.translate.join(",")+")scale("+d3.event.scale+")");g.selectAll("path").attr("d",path.projection(projection));}});svg.call(zoom)},makeMapTraffic:function(container,data,options){var cfg={title:"",labels:true,tickLabelFormat:".2s",geojson:"world.json"};if('undefined'!==typeof options){for(var i in options){if('undefined'!==typeof options[i]){cfg[i]=options[i];}}}
var formatNumber=d3.format(cfg.tickLabelFormat);var div=d3.select("#"+container);var w=parseInt(div.style("width"));var h=parseInt(div.style("height"));this.removeDiv(container);var tip=d3.tip(container).attr('class','d3-tip').html(function(d){return("From: "+d.origin+"<br>To: "+d.dest+"<br>Value: <span class='valuecolor'>"+formatNumber(d.value)+"</span> ");});var width=w;var height=h;if(cfg.legend){var right=100;}else{var right=0;}
if(cfg.title.length>0){var margin={top:30,right:right,bottom:0,left:0};}else{var margin={top:0,right:right,bottom:0,left:0};}
var width=w-margin.left-margin.right;var height=h-margin.top-margin.bottom;var svg=d3.select("#"+container).append("svg").attr("width",w).attr("height",h).attr("transform","translate("+margin.left+","+margin.top+")");var map=svg.append("svg").attr("id","map").attr("class","map").attr("y",margin.top).attr("width",width).attr("height",height).call(tip);var projection=d3.geo.mercator().center([90,0]).scale(500).rotate([0,0]);var path=d3.geo.path().projection(projection);var arc=d3.geo.greatArc().precision(3);var g=map.append("g");var nodeDataByCode={},links=[];function nodeCoords(node){var lon=parseFloat(node.lon),lat=parseFloat(node.lat);if(isNaN(lon)||isNaN(lat))return null;return[lon,lat];};data[0].nodes.forEach(function(node){node.coords=nodeCoords(node);node.projection=projection(node.coords);nodeDataByCode[node.name]=node;});data[0].flows.forEach(function(flow){if(nodeDataByCode[flow.origin]){var o=nodeDataByCode[flow.origin],co=o.coords,po=o.projection;var d=nodeDataByCode[flow.dest],cd=d.coords,pd=d.projection;var magnitude=parseFloat(flow.value);if(co&&cd&&!isNaN(magnitude)){links.push({type:"LineString",coordinates:[co,cd],value:flow.value,origin:flow.origin,dest:flow.dest});}}else{}});var lScale=d3.scale.linear().domain([0,d3.max(links,function(d){return d.value;})]).range([1,8]);var stateGroup=g.append('g');var arcGroup=g.append('g');var pointGroup=g.append('g');var txtGroup=g.append('g');d3.json(cfg.geojson,function(json){stateGroup.attr("id","states").selectAll("path").data(json.features).enter().append("path").attr("d",path).attr("class","country")
var pathArcs=arcGroup.selectAll(".arc").data(links).enter().append("path").attr("d",path).attr("class","arc").style("fill","none").style("stroke","#ff0000").style("stroke-opacity","0.75").style("stroke-linejoin","round").style("stroke-linecap","round").style("stroke-width",function(d){return lScale(d.value)+"px"}).on('mouseover',tip.show).on('mouseout',tip.hide);var point=pointGroup.append("g").attr("class","points").selectAll("g").data(data[0].nodes).enter().append("circle").attr("cx",function(d){return projection([d.lon,d.lat])[0];}).attr("cy",function(d){return projection([d.lon,d.lat])[1];}).attr("r",2).style("fill","black");if(cfg.labels){var txt=txtGroup.append("g").selectAll("g").data(data[0].nodes).enter().append("text").attr("x",function(d){return projection([d.lon,d.lat])[0];}).attr("y",function(d){return projection([d.lon,d.lat])[1]-3;}).style("text-anchor","middle").style("font-size","1.75px").text(function(d){return d.name});}
zoomtobbox(data)});if(cfg.title.length>0){svg.append("g").attr("class","charttitle").append("text").attr("x",width/2).attr("y",18).attr("text-anchor","middle").attr("class","charttitle").text(cfg.title);}
var zoom=d3.behavior.zoom().on("zoom",function(){g.attr("transform","translate("+
d3.event.translate.join(",")+")scale("+d3.event.scale+")");g.selectAll("circle").attr("d",path.projection(projection));g.selectAll("path").attr("d",path.projection(projection));});svg.call(zoom)
function zoomtobbox(data){var x1=d3.min(data[0].nodes,function(d){return d.lon;});var y1=d3.min(data[0].nodes,function(d){return d.lat;});var x2=d3.max(data[0].nodes,function(d){return d.lon;});var y2=d3.max(data[0].nodes,function(d){return d.lat;});var p1=projection([x1,y1]);var p2=projection([x2,y2]);var x1=p1[0];var y1=p1[1];var x2=p2[0];var y2=p2[1];var bboxwgs=[x1,y1,x2,y2];var dx=x2-x1;var dy=y2-y1;var x=(x1+x2)/2;var y=(y1+y2)/2;scale=.8/Math.max(dx/width,dy/height),translate=[width/2-scale*x,height/2-scale*y];g.transition().duration(750).attr("transform","translate("+translate+")scale("+scale+")");};},removeDiv:function(ChartArea){var obj=document.getElementById(ChartArea);if(obj.children.length>0){while(obj.firstChild)obj.removeChild(obj.firstChild);}},};d3.sankey=function(){var sankey={},nodeWidth=24,nodePadding=8,size=[1,1],nodes=[],links=[],cycleLaneNarrowWidth=4,cycleLaneDistFromFwdPaths=-10,cycleDistFromNode=30,cycleControlPointDist=30,cycleSmallWidthBuffer=2;sankey.nodeWidth=function(_){if(!arguments.length)return nodeWidth;nodeWidth=+_;return sankey;};sankey.nodePadding=function(_){if(!arguments.length)return nodePadding;nodePadding=+_;return sankey;};sankey.cycleLaneNarrowWidth=function(_){if(!arguments.length)return cycleLaneNarrowWidth;cycleLaneNarrowWidth=+_;return sankey;}
sankey.cycleSmallWidthBuffer=function(_){if(!arguments.length)return cycleSmallWidthBuffer;cycleSmallWidthBuffer=+_;return sankey;}
sankey.cycleLaneDistFromFwdPaths=function(_){if(!arguments.length)return cycleLaneDistFromFwdPaths;cycleLaneDistFromFwdPaths=+_;return sankey;}
sankey.cycleDistFromNode=function(_){if(!arguments.length)return cycleDistFromNode;cycleDistFromNode=+_;return sankey;}
sankey.cycleControlPointDist=function(_){if(!arguments.length)return cycleControlPointDist;cycleControlPointDist=+_;return sankey;}
sankey.nodes=function(_){if(!arguments.length)return nodes;nodes=_;return sankey;};sankey.links=function(_){if(!arguments.length)return links;links=_;return sankey;};sankey.size=function(_){if(!arguments.length)return size;size=_;return sankey;};sankey.layout=function(iterations){computeNodeLinks();computeNodeValues();markCycles();computeNodeBreadths();computeNodeDepths(iterations);computeLinkDepths();return sankey;};sankey.relayout=function(){computeLinkDepths();return sankey;};sankey.link=function(){var curvature=.5;function link(d){if(d.causesCycle){var smallWidth=cycleLaneNarrowWidth,s_x=d.source.x+d.source.dx,s_y=d.source.y+d.sy+d.dy,t_x=d.target.x,t_y=d.target.y,se_x=s_x+cycleDistFromNode,se_y=s_y,ne_x=se_x,ne_y=cycleLaneDistFromFwdPaths-(d.cycleIndex*(smallWidth+cycleSmallWidthBuffer)),nw_x=t_x-cycleDistFromNode,nw_y=ne_y,sw_x=nw_x,sw_y=t_y+d.ty+d.dy;return"M"+s_x+","+s_y
+"L"+se_x+","+se_y
+"C"+(se_x+cycleControlPointDist)+","+se_y+" "+(ne_x+cycleControlPointDist)+","+ne_y+" "+ne_x+","+ne_y
+"H"+nw_x
+"C"+(nw_x-cycleControlPointDist)+","+nw_y+" "+(sw_x-cycleControlPointDist)+","+sw_y+" "+sw_x+","+sw_y
+"H"+t_x
+"V"+(t_y+d.ty)
+"H"+sw_x
+"C"+(sw_x-(cycleControlPointDist/2)+smallWidth)+","+t_y+" "+
(nw_x-(cycleControlPointDist/2)+smallWidth)+","+(nw_y+smallWidth)+" "+
nw_x+","+(nw_y+smallWidth)
+"H"+(ne_x-smallWidth)
+"C"+(ne_x+(cycleControlPointDist/2)-smallWidth)+","+(ne_y+smallWidth)+" "+
(se_x+(cycleControlPointDist/2)-smallWidth)+","+(se_y-d.dy)+" "+
se_x+","+(se_y-d.dy)
+"L"+s_x+","+(s_y-d.dy);}else{var x0=d.source.x+d.source.dx,x1=d.target.x,xi=d3.interpolateNumber(x0,x1),x2=xi(curvature),x3=xi(1-curvature),y0=d.source.y+d.sy+d.dy/2,y1=d.target.y+d.ty+d.dy/2;return"M"+x0+","+y0
+"C"+x2+","+y0
+" "+x3+","+y1
+" "+x1+","+y1;}}
link.curvature=function(_){if(!arguments.length)return curvature;curvature=+_;return link;};return link;};function computeNodeLinks(){nodes.forEach(function(node){node.sourceLinks=[];node.targetLinks=[];});links.forEach(function(link){var source=link.source,target=link.target;if(typeof source==="number")source=link.source=nodes[link.source];if(typeof target==="number")target=link.target=nodes[link.target];source.sourceLinks.push(link);target.targetLinks.push(link);});}
function computeNodeValues(){nodes.forEach(function(node){node.value=Math.max(d3.sum(node.sourceLinks,value),d3.sum(node.targetLinks,value));});}
function computeNodeBreadths(){var remainingNodes=nodes,nextNodes,x=0;while(remainingNodes.length){nextNodes=[];remainingNodes.forEach(function(node){node.x=x;node.dx=nodeWidth;node.sourceLinks.forEach(function(link){if(!link.causesCycle){nextNodes.push(link.target);}});});remainingNodes=nextNodes;++x;}
moveSinksRight(x);scaleNodeBreadths((size[0]-nodeWidth)/(x-1));}
function moveSourcesRight(){nodes.forEach(function(node){if(!node.targetLinks.length){node.x=d3.min(node.sourceLinks,function(d){return d.target.x;})-1;}});}
function moveSinksRight(x){nodes.forEach(function(node){if(!node.sourceLinks.length){node.x=x-1;}});}
function scaleNodeBreadths(kx){nodes.forEach(function(node){node.x*=kx;});}
function computeNodeDepths(iterations){var nodesByBreadth=d3.nest().key(function(d){return d.x;}).sortKeys(d3.ascending).entries(nodes).map(function(d){return d.values;});initializeNodeDepth();resolveCollisions();for(var alpha=1;iterations>0;--iterations){relaxRightToLeft(alpha*=.99);resolveCollisions();relaxLeftToRight(alpha);resolveCollisions();}
function initializeNodeDepth(){var ky=d3.min(nodesByBreadth,function(nodes){return(size[1]-(nodes.length-1)*nodePadding)/d3.sum(nodes,value);});nodesByBreadth.forEach(function(nodes){nodes.forEach(function(node,i){node.y=i;node.dy=node.value*ky;});});links.forEach(function(link){link.dy=link.value*ky;});}
function relaxLeftToRight(alpha){nodesByBreadth.forEach(function(nodes,breadth){nodes.forEach(function(node){if(node.targetLinks.length){var y=d3.sum(node.targetLinks,weightedSource)/d3.sum(node.targetLinks,value);node.y+=(y-center(node))*alpha;}});});function weightedSource(link){return center(link.source)*link.value;}}
function relaxRightToLeft(alpha){nodesByBreadth.slice().reverse().forEach(function(nodes){nodes.forEach(function(node){if(node.sourceLinks.length){var y=d3.sum(node.sourceLinks,weightedTarget)/d3.sum(node.sourceLinks,value);node.y+=(y-center(node))*alpha;}});});function weightedTarget(link){return center(link.target)*link.value;}}
function resolveCollisions(){nodesByBreadth.forEach(function(nodes){var node,dy,y0=0,n=nodes.length,i;nodes.sort(ascendingDepth);for(i=0;i<n;++i){node=nodes[i];dy=y0-node.y;if(dy>0)node.y+=dy;y0=node.y+node.dy+nodePadding;}
dy=y0-nodePadding-size[1];if(dy>0){y0=node.y-=dy;for(i=n-2;i>=0;--i){node=nodes[i];dy=node.y+node.dy+nodePadding-y0;if(dy>0)node.y-=dy;y0=node.y;}}});}
function ascendingDepth(a,b){return a.y-b.y;}}
function computeLinkDepths(){nodes.forEach(function(node){node.sourceLinks.sort(ascendingTargetDepth);node.targetLinks.sort(ascendingSourceDepth);});nodes.forEach(function(node){var sy=0,ty=0;node.sourceLinks.forEach(function(link){link.sy=sy;sy+=link.dy;});node.targetLinks.forEach(function(link){link.ty=ty;ty+=link.dy;});});function ascendingSourceDepth(a,b){return a.source.y-b.source.y;}
function ascendingTargetDepth(a,b){return a.target.y-b.target.y;}}
function center(node){return node.y+node.dy/2;}
function value(link){return link.value;}
function markCycles(){var cycleMakers=[];var addedLinks=new Array();links.forEach(function(link){if(createsCycle(link.source,link.target,addedLinks)){link.causesCycle=true;link.cycleIndex=cycleMakers.length;cycleMakers.push(link);}else{addedLinks.push(link);}});};function createsCycle(originalSource,nodeToCheck,graph){if(graph.length==0){return false;}
var nextLinks=findLinksOutward(nodeToCheck,graph);if(nextLinks.length==0){return false;}
for(var i=0;i<nextLinks.length;i++){var nextLink=nextLinks[i];if(nextLink.target===originalSource){return true;}
if(createsCycle(originalSource,nextLink.target,graph)){return true;}}
return false;};function findLinksOutward(node,graph){var children=[];for(var i=0;i<graph.length;i++){if(node==graph[i].source){children.push(graph[i]);}}
return children;}
return sankey;};d3.tip=function(container){var direction=d3_tip_direction,offset=d3_tip_offset,html=d3_tip_html,node=initNode(),svg=null,point=null,target=null
function tip(vis){svg=getSVGNode(vis)
point=svg.createSVGPoint()
document.body.appendChild(node)}
tip.show=function(){tipTimeout=1;var cmd="if (tipTimeout>0) { tipTimeout=0; nodel = d3.selectAll('.d3-tip'); nodel.style({ opacity: 0, 'pointer-events': 'none' }) }";setTimeout(cmd,tooltipDelay);var args=Array.prototype.slice.call(arguments)
if(args[args.length-1]instanceof SVGElement)target=args.pop()
var content=html.apply(this,args),poffset=offset.apply(this,args),dir=direction.apply(this,args),nodel=d3.select(node),i=directions.length,coords,scrollTop=document.documentElement.scrollTop||document.body.scrollTop,scrollLeft=document.documentElement.scrollLeft||document.body.scrollLeft
nodel.html(content).style({opacity:1,'pointer-events':'all'})
while(i--)nodel.classed(directions[i],false)
coords=direction_callbacks.get(dir).apply(this)
nodel.classed(dir,true).style({top:(coords.top+poffset[0])+scrollTop+'px',left:(coords.left+poffset[1])+scrollLeft+'px'})
return tip}
tip.hide=function(){tipTimeout=0;nodel=d3.select(node)
nodel.style({opacity:0,'pointer-events':'none'})
return tip}
tip.attr=function(n,v){if(arguments.length<2&&typeof n==='string'){return d3.select(node).attr(n)}else{var args=Array.prototype.slice.call(arguments)
d3.selection.prototype.attr.apply(d3.select(node),args)}
return tip}
tip.style=function(n,v){if(arguments.length<2&&typeof n==='string'){return d3.select(node).style(n)}else{var args=Array.prototype.slice.call(arguments)
d3.selection.prototype.style.apply(d3.select(node),args)}
return tip}
tip.direction=function(v){if(!arguments.length)return direction
direction=v==null?v:d3.functor(v)
return tip}
tip.offset=function(v){if(!arguments.length)return offset
offset=v==null?v:d3.functor(v)
return tip}
tip.html=function(v){if(!arguments.length)return html
html=v==null?v:d3.functor(v)
return tip}
function d3_tip_direction(){return'n'}
function d3_tip_offset(){return[0,0]}
function d3_tip_html(){return' '}
var direction_callbacks=d3.map({n:direction_n,s:direction_s,e:direction_e,w:direction_w,nw:direction_nw,ne:direction_ne,sw:direction_sw,se:direction_se}),directions=direction_callbacks.keys()
function direction_n(){var bbox=getScreenBBox()
return{top:bbox.n.y-node.offsetHeight,left:bbox.n.x-node.offsetWidth/2}}
function direction_s(){var bbox=getScreenBBox()
return{top:bbox.s.y,left:bbox.s.x-node.offsetWidth/2}}
function direction_e(){var bbox=getScreenBBox()
return{top:bbox.e.y-node.offsetHeight/2,left:bbox.e.x}}
function direction_w(){var bbox=getScreenBBox()
return{top:bbox.w.y-node.offsetHeight/2,left:bbox.w.x-node.offsetWidth}}
function direction_nw(){var bbox=getScreenBBox()
return{top:bbox.nw.y-node.offsetHeight,left:bbox.nw.x-node.offsetWidth}}
function direction_ne(){var bbox=getScreenBBox()
return{top:bbox.ne.y-node.offsetHeight,left:bbox.ne.x}}
function direction_sw(){var bbox=getScreenBBox()
return{top:bbox.sw.y,left:bbox.sw.x-node.offsetWidth}}
function direction_se(){var bbox=getScreenBBox()
return{top:bbox.se.y,left:bbox.e.x}}
function initNode(){var node=d3.select(document.createElement('div'))
node.style({position:'absolute',top:0,opacity:0,'pointer-events':'none','box-sizing':'border-box'})
return node.node()}
function getSVGNode(el){el=el.node()
if(el.tagName.toLowerCase()=='svg')
return el
return el.ownerSVGElement}
function getScreenBBox(){var targetel=target||d3.event.target,bbox={},matrix=targetel.getScreenCTM(),tbbox=targetel.getBBox(),width=tbbox.width,height=tbbox.height,x=tbbox.x,y=tbbox.y
point.x=x
point.y=y
bbox.nw=point.matrixTransform(matrix)
point.x+=width
bbox.ne=point.matrixTransform(matrix)
point.y+=height
bbox.se=point.matrixTransform(matrix)
point.x-=width
bbox.sw=point.matrixTransform(matrix)
point.y-=height/2
bbox.w=point.matrixTransform(matrix)
point.x+=width
bbox.e=point.matrixTransform(matrix)
point.x-=width/2
point.y-=height/2
bbox.n=point.matrixTransform(matrix)
point.y+=height
bbox.s=point.matrixTransform(matrix)
return bbox}
return tip};(function(){function cloud(){var size=[512,512],text=cloudText,font=cloudFont,fontSize=cloudFontSize,fontStyle=cloudFontNormal,fontWeight=cloudFontNormal,rotate=cloudRotate,padding=cloudPadding,spiral=archimedeanSpiral,words=[],timeInterval=Infinity,event=d3.dispatch("word","end"),timer=null,cloud={};cloud.start=function(){var board=zeroArray((size[0]>>5)*size[1]),bounds=null,n=words.length,i=-1,tags=[],data=words.map(function(d,i){d.text=text.call(this,d,i);d.font=font.call(this,d,i);d.style=fontStyle.call(this,d,i);d.weight=fontWeight.call(this,d,i);d.rotate=rotate.call(this,d,i);d.size=~~fontSize.call(this,d,i);d.padding=padding.call(this,d,i);return d;}).sort(function(a,b){return b.size-a.size;});if(timer)clearInterval(timer);timer=setInterval(step,0);step();return cloud;function step(){var start=+new Date,d;while(+new Date-start<timeInterval&&++i<n&&timer){d=data[i];d.x=(size[0]*(Math.random()+.5))>>1;d.y=(size[1]*(Math.random()+.5))>>1;cloudSprite(d,data,i);if(d.hasText&&place(board,d,bounds)){tags.push(d);event.word(d);if(bounds)cloudBounds(bounds,d);else bounds=[{x:d.x+d.x0,y:d.y+d.y0},{x:d.x+d.x1,y:d.y+d.y1}];d.x-=size[0]>>1;d.y-=size[1]>>1;}}
if(i>=n){cloud.stop();event.end(tags,bounds);}}}
cloud.stop=function(){if(timer){clearInterval(timer);timer=null;}
return cloud;};cloud.timeInterval=function(x){if(!arguments.length)return timeInterval;timeInterval=x==null?Infinity:x;return cloud;};function place(board,tag,bounds){var perimeter=[{x:0,y:0},{x:size[0],y:size[1]}],startX=tag.x,startY=tag.y,maxDelta=Math.sqrt(size[0]*size[0]+size[1]*size[1]),s=spiral(size),dt=Math.random()<.5?1:-1,t=-dt,dxdy,dx,dy;while(dxdy=s(t+=dt)){dx=~~dxdy[0];dy=~~dxdy[1];if(Math.min(dx,dy)>maxDelta)break;tag.x=startX+dx;tag.y=startY+dy;if(tag.x+tag.x0<0||tag.y+tag.y0<0||tag.x+tag.x1>size[0]||tag.y+tag.y1>size[1])continue;if(!bounds||!cloudCollide(tag,board,size[0])){if(!bounds||collideRects(tag,bounds)){var sprite=tag.sprite,w=tag.width>>5,sw=size[0]>>5,lx=tag.x-(w<<4),sx=lx&0x7f,msx=32-sx,h=tag.y1-tag.y0,x=(tag.y+tag.y0)*sw+(lx>>5),last;for(var j=0;j<h;j++){last=0;for(var i=0;i<=w;i++){board[x+i]|=(last<<msx)|(i<w?(last=sprite[j*w+i])>>>sx:0);}
x+=sw;}
delete tag.sprite;return true;}}}
return false;}
cloud.words=function(x){if(!arguments.length)return words;words=x;return cloud;};cloud.size=function(x){if(!arguments.length)return size;size=[+x[0],+x[1]];return cloud;};cloud.font=function(x){if(!arguments.length)return font;font=d3.functor(x);return cloud;};cloud.fontStyle=function(x){if(!arguments.length)return fontStyle;fontStyle=d3.functor(x);return cloud;};cloud.fontWeight=function(x){if(!arguments.length)return fontWeight;fontWeight=d3.functor(x);return cloud;};cloud.rotate=function(x){if(!arguments.length)return rotate;rotate=d3.functor(x);return cloud;};cloud.text=function(x){if(!arguments.length)return text;text=d3.functor(x);return cloud;};cloud.spiral=function(x){if(!arguments.length)return spiral;spiral=spirals[x+""]||x;return cloud;};cloud.fontSize=function(x){if(!arguments.length)return fontSize;fontSize=d3.functor(x);return cloud;};cloud.padding=function(x){if(!arguments.length)return padding;padding=d3.functor(x);return cloud;};return d3.rebind(cloud,event,"on");}
function cloudText(d){return d.text;}
function cloudFont(){return"serif";}
function cloudFontNormal(){return"normal";}
function cloudFontSize(d){return Math.sqrt(d.value);}
function cloudRotate(){return(~~(Math.random()*6)-3)*30;}
function cloudPadding(){return 1;}
function cloudSprite(d,data,di){if(d.sprite)return;c.clearRect(0,0,(cw<<5)/ratio,ch/ratio);var x=0,y=0,maxh=0,n=data.length;--di;while(++di<n){d=data[di];c.save();c.font=d.style+" "+d.weight+" "+~~((d.size+1)/ratio)+"px "+d.font;var w=c.measureText(d.text+"m").width*ratio,h=d.size<<1;if(d.rotate){var sr=Math.sin(d.rotate*cloudRadians),cr=Math.cos(d.rotate*cloudRadians),wcr=w*cr,wsr=w*sr,hcr=h*cr,hsr=h*sr;w=(Math.max(Math.abs(wcr+hsr),Math.abs(wcr-hsr))+0x1f)>>5<<5;h=~~Math.max(Math.abs(wsr+hcr),Math.abs(wsr-hcr));}else{w=(w+0x1f)>>5<<5;}
if(h>maxh)maxh=h;if(x+w>=(cw<<5)){x=0;y+=maxh;maxh=0;}
if(y+h>=ch)break;c.translate((x+(w>>1))/ratio,(y+(h>>1))/ratio);if(d.rotate)c.rotate(d.rotate*cloudRadians);c.fillText(d.text,0,0);if(d.padding)c.lineWidth=2*d.padding,c.strokeText(d.text,0,0);c.restore();d.width=w;d.height=h;d.xoff=x;d.yoff=y;d.x1=w>>1;d.y1=h>>1;d.x0=-d.x1;d.y0=-d.y1;d.hasText=true;x+=w;}
var pixels=c.getImageData(0,0,(cw<<5)/ratio,ch/ratio).data,sprite=[];while(--di>=0){d=data[di];if(!d.hasText)continue;var w=d.width,w32=w>>5,h=d.y1-d.y0;for(var i=0;i<h*w32;i++)sprite[i]=0;x=d.xoff;if(x==null)return;y=d.yoff;var seen=0,seenRow=-1;for(var j=0;j<h;j++){for(var i=0;i<w;i++){var k=w32*j+(i>>5),m=pixels[((y+j)*(cw<<5)+(x+i))<<2]?1<<(31-(i%32)):0;sprite[k]|=m;seen|=m;}
if(seen)seenRow=j;else{d.y0++;h--;j--;y++;}}
d.y1=d.y0+seenRow;d.sprite=sprite.slice(0,(d.y1-d.y0)*w32);}}
function cloudCollide(tag,board,sw){sw>>=5;var sprite=tag.sprite,w=tag.width>>5,lx=tag.x-(w<<4),sx=lx&0x7f,msx=32-sx,h=tag.y1-tag.y0,x=(tag.y+tag.y0)*sw+(lx>>5),last;for(var j=0;j<h;j++){last=0;for(var i=0;i<=w;i++){if(((last<<msx)|(i<w?(last=sprite[j*w+i])>>>sx:0))&board[x+i])return true;}
x+=sw;}
return false;}
function cloudBounds(bounds,d){var b0=bounds[0],b1=bounds[1];if(d.x+d.x0<b0.x)b0.x=d.x+d.x0;if(d.y+d.y0<b0.y)b0.y=d.y+d.y0;if(d.x+d.x1>b1.x)b1.x=d.x+d.x1;if(d.y+d.y1>b1.y)b1.y=d.y+d.y1;}
function collideRects(a,b){return a.x+a.x1>b[0].x&&a.x+a.x0<b[1].x&&a.y+a.y1>b[0].y&&a.y+a.y0<b[1].y;}
function archimedeanSpiral(size){var e=size[0]/size[1];return function(t){return[e*(t*=.1)*Math.cos(t),t*Math.sin(t)];};}
function rectangularSpiral(size){var dy=4,dx=dy*size[0]/size[1],x=0,y=0;return function(t){var sign=t<0?-1:1;switch((Math.sqrt(1+4*sign*t)-sign)&3){case 0:x+=dx;break;case 1:y+=dy;break;case 2:x-=dx;break;default:y-=dy;break;}
return[x,y];};}
function zeroArray(n){var a=[],i=-1;while(++i<n)a[i]=0;return a;}
var cloudRadians=Math.PI/180,cw=1<<11>>5,ch=1<<11,canvas,ratio=1;if(typeof document!=="undefined"){canvas=document.createElement("canvas");canvas.width=1;canvas.height=1;ratio=Math.sqrt(canvas.getContext("2d").getImageData(0,0,1,1).data.length>>2);canvas.width=(cw<<5)/ratio;canvas.height=ch/ratio;}else{canvas=new Canvas(cw<<5,ch);}
var c=canvas.getContext("2d"),spirals={archimedean:archimedeanSpiral,rectangular:rectangularSpiral};c.fillStyle=c.strokeStyle="red";c.textAlign="center";if(typeof module==="object"&&module.exports)module.exports=cloud;else(d3.layout||(d3.layout={})).cloud=cloud;})();(function(){d3.hexbin=function(){var width=1,height=1,r,x=d3_hexbinX,y=d3_hexbinY,dx,dy;function hexbin(points){var binsById={};points.forEach(function(point,i){var py=y.call(hexbin,point,i)/dy,pj=Math.round(py),px=x.call(hexbin,point,i)/dx-(pj&1?.5:0),pi=Math.round(px),py1=py-pj;if(Math.abs(py1)*3>1){var px1=px-pi,pi2=pi+(px<pi?-1:1)/2,pj2=pj+(py<pj?-1:1),px2=px-pi2,py2=py-pj2;if(px1*px1+py1*py1>px2*px2+py2*py2)pi=pi2+(pj&1?1:-1)/2,pj=pj2;}
var id=pi+"-"+pj,bin=binsById[id];if(bin)bin.push(point);else{bin=binsById[id]=[point];bin.x=(pi+(pj&1?1/2:0))*dx;bin.y=pj*dy;}});return d3.values(binsById);}
function hexagon(radius){var x0=0,y0=0;return d3_hexbinAngles.map(function(angle){var x1=Math.sin(angle)*radius,y1=-Math.cos(angle)*radius,dx=x1-x0,dy=y1-y0;x0=x1,y0=y1;return[dx,dy];});}
hexbin.x=function(_){if(!arguments.length)return x;x=_;return hexbin;};hexbin.y=function(_){if(!arguments.length)return y;y=_;return hexbin;};hexbin.hexagon=function(radius){if(arguments.length<1)radius=r;return"m"+hexagon(radius).join("l")+"z";};hexbin.centers=function(){var centers=[];for(var y=0,odd=false;y<height+r;y+=dy,odd=!odd){for(var x=odd?dx/2:0;x<width;x+=dx){centers.push([x,y]);}}
return centers;};hexbin.mesh=function(){var fragment=hexagon(r).slice(0,4).join("l");return hexbin.centers().map(function(p){return"M"+p+"m"+fragment;}).join("");};hexbin.size=function(_){if(!arguments.length)return[width,height];width=+_[0],height=+_[1];return hexbin;};hexbin.radius=function(_){if(!arguments.length)return r;r=+_;dx=r*2*Math.sin(Math.PI/3);dy=r*1.5;return hexbin;};return hexbin.radius(1);};var d3_hexbinAngles=d3.range(0,2*Math.PI,Math.PI/3),d3_hexbinX=function(d){return d[0];},d3_hexbinY=function(d){return d[1];};})();